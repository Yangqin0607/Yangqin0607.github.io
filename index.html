<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.6" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/html_small.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/html_big.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/html_big.png?v=6.0.6">


  <link rel="mask-icon" href="/images/html.svg?v=6.0.6" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.0.6',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Front End Engineer">
<meta property="og:type" content="website">
<meta property="og:title" content="Ailsa&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Ailsa&#39;s blog">
<meta property="og:description" content="Front End Engineer">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ailsa&#39;s blog">
<meta name="twitter:description" content="Front End Engineer">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Ailsa's blog</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Ailsa's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Front End Engineer</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
</li>

      

      
    </ul>
  

  
    

  

  
</nav>


  



 </div>
    </header>

    
  
  
  
    
      
    
    <a href="https://github.com/Yangqin0607" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#222; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg>
    
      </a>
    



    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/05/02/surviveJS-webpack-building/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ailsa">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ailsa's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/02/surviveJS-webpack-building/" itemprop="url">surviveJS-webpack-building 学习笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-02T19:10:56+08:00">2018-05-02</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/05/02/surviveJS-webpack-building/" class="leancloud_visitors" data-flag-title="surviveJS-webpack-building 学习笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views:</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong><a href="https://survivejs.com/webpack/building/" target="_blank" rel="noopener">surviveJS-webpack-building</a></strong></p>
<h1 id="Source-Maps"><a href="#Source-Maps" class="headerlink" title="Source Maps"></a>Source Maps</h1><p>如果在浏览器打开网页调试，我们会看到打包后的代码，当出现问题的时候，我们怎么定位到原始的代码中呢。这个时候就需要借助source maps，它提供原始代码和打包后的代码之间的映射，不仅可以映射JS，也可以用于CSS。</p>
<p>webpack 4中当mode为development时，会自动为你开启source maps。</p>
<h2 id="Inline-source-maps-and-Separate-source-maps"><a href="#Inline-source-maps-and-Separate-source-maps" class="headerlink" title="Inline source maps and Separate source maps"></a>Inline source maps and Separate source maps</h2><p>webpack提供了行内source map和分离的source map。在开发模式下，行内source map性能会更好；分离的source map更适合生产模式，这样不会增大bundle的大小，并且可以选择是否加载source maps。</p>
<h2 id="Enabling-source-maps"><a href="#Enabling-source-maps" class="headerlink" title="Enabling source maps"></a>Enabling source maps</h2><p>webpack提供两种开启source map的方法。使用devtool配置字段；或者使用插件来提供更多控制；除了webpack需要配置，还需要开启你开发所在浏览器的source map功能。</p>
<h3 id="Enabling-source-maps-in-webpack"><a href="#Enabling-source-maps-in-webpack" class="headerlink" title="Enabling source maps in webpack"></a>Enabling source maps in webpack</h3><p>webpack.parts.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exports.generateSourceMaps = <span class="function">(<span class="params">&#123; type &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  devtool: type,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>webpack支持多种source map类型，这些source map主要是在性能和编译速度上不一样。我们可以在生产环境开启source-map，在开发环境使用webpack提供的默认选项。因此可以这样设置：<br>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> productionConfig = merge([</span><br><span class="line"></span><br><span class="line">  parts.generateSourceMaps(&#123; <span class="attr">type</span>: <span class="string">"source-map"</span> &#125;),</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">]);</span><br></pre></td></tr></table></figure></p>
<p>source-map是编译最慢但是性能最好的一种source map类型，但是用在生产环境也是一种不错的选择。<br><code>yarn run prod</code>看下控制台的输出：<br><img src="/2018/05/02/surviveJS-webpack-building/source-map.png" alt=""><br>可以看一下.map的文件，里面存放的就是源代码和打包后代码的映射。在开发环境下，这些映射信息写在bundle中。</p>
<h3 id="Enabling-source-maps-in-browsers"><a href="#Enabling-source-maps-in-browsers" class="headerlink" title="Enabling source maps in browsers"></a>Enabling source maps in browsers</h3><p><a href="https://developers.google.com/web/tools/chrome-devtools/" target="_blank" rel="noopener">chrome</a> 调试方法。<br>其他浏览器可以自行谷歌。</p>
<h2 id="Source-map-types-supported-by-webpack"><a href="#Source-map-types-supported-by-webpack" class="headerlink" title="Source map types supported by webpack"></a>Source map types supported by webpack</h2><p>source maps主要分两类：</p>
<ul>
<li>inline 行内source map将映射数据直接存放在打包后的文件中</li>
<li>separate 分离source map将映射数据存放在单独的文件中，使用评论链接源代码<br>inline source map打包速度快，适合于开发环境，但因为内联的方式，会增大bundle的体积。因此在生产环境中适合使用separate source map。</li>
</ul>
<h3 id="inline-source-maps"><a href="#inline-source-maps" class="headerlink" title="inline source maps"></a>inline source maps</h3><p>webpack提供了多种内联source map，一般都包含‘eval’, 其中<code>cheap-module-eval-source-map</code>在chrome和firefox上都很稳定，并且在速度和性能上也都不错。<br>下面列出了webpack提供的inline source map，并且都有示例。源代码中只有一句<code>console.log(&#39;hello world&#39;)</code>,并且使用了<code>webpack.NamedModulesPlugin</code>来帮助理解。<a href="https://survivejs.com/webpack/building/source-maps/" target="_blank" rel="noopener">示例原文</a></p>
<h4 id="devtool-“eval”"><a href="#devtool-“eval”" class="headerlink" title="devtool: “eval”"></a>devtool: “eval”</h4><p>每个模块都用eval函数包裹。</p>
<h4 id="devtool-“cheap-eval-source-map”"><a href="#devtool-“cheap-eval-source-map”" class="headerlink" title="devtool: “cheap-eval-source-map”"></a>devtool: “cheap-eval-source-map”</h4><p><code>cheap-eval-source-map</code>更进一步，将代码信息用base64编码为data url，只包含行信息，无列信息。</p>
<h4 id="devtool-“cheap-module-eval-source-map”"><a href="#devtool-“cheap-module-eval-source-map”" class="headerlink" title="devtool: “cheap-module-eval-source-map”"></a>devtool: “cheap-module-eval-source-map”</h4><p>这种方式品质更高，但是速度会慢一些。</p>
<h4 id="devtool-“eval-source-map”"><a href="#devtool-“eval-source-map”" class="headerlink" title="devtool: “eval-source-map”"></a>devtool: “eval-source-map”</h4><p>是品质最高的行内source map，但构建速度也是最慢的。</p>
<h3 id="separate-source-maps"><a href="#separate-source-maps" class="headerlink" title="separate source maps"></a>separate source maps</h3><p>分离的source map会将映射关系存放在以.map为扩展名的文件中，需要时才会被浏览器加载。</p>
<h4 id="devtool-“cheap-source-map”"><a href="#devtool-“cheap-source-map”" class="headerlink" title="devtool: “cheap-source-map”"></a>devtool: “cheap-source-map”</h4><p><code>cheap-source-map</code>和上面那些带cheap的选项一样，不包含列映射以及来自loader，比如css-loader的source map。</p>
<h4 id="devtool-“cheap-module-source-map”"><a href="#devtool-“cheap-module-source-map”" class="headerlink" title="devtool: “cheap-module-source-map”"></a>devtool: “cheap-module-source-map”</h4><p><code>cheap-module-source-map</code>和<code>cheap-source-map</code>相似，但是包含loaders的source map。</p>
<h4 id="devtool-“hidden-source-map”"><a href="#devtool-“hidden-source-map”" class="headerlink" title="devtool: “hidden-source-map”"></a>devtool: “hidden-source-map”</h4><p>和source-map相似，但是不会在源文件中写入source maps的引用。如果你不想直接在开发者工具中暴露source maps，只需要stack traces，可以使用这种方式。</p>
<h4 id="devtool-“nosources-source-map”"><a href="#devtool-“nosources-source-map”" class="headerlink" title="devtool: “nosources-source-map”"></a>devtool: “nosources-source-map”</h4><p>这种方式创建的source map没有source content，只提供stack traces。如果不想将源代码暴露到客户端可以使用这种方式。</p>
<h4 id="devtool-“source-map”"><a href="#devtool-“source-map”" class="headerlink" title="devtool: “source-map”"></a>devtool: “source-map”</h4><p><code>source-map</code>构建速度慢，但是性能很好。如果你不在意生产环境的source maps，也可以不设置source map。</p>
<p>下面<a href="https://www.webpackjs.com/configuration/devtool/" target="_blank" rel="noopener">这张图</a>对比了这些source maps;<br><img src="/2018/05/02/surviveJS-webpack-building/sourcemaptypes.png" alt=""></p>
<h3 id="other-source-map-options"><a href="#other-source-map-options" class="headerlink" title="other source map options"></a>other source map options</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  output: &#123;</span><br><span class="line">    <span class="comment">// Modify the name of the generated source map file.</span></span><br><span class="line">    <span class="comment">// You can use [file], [id], and [hash] replacements here.</span></span><br><span class="line">    <span class="comment">// The default option is enough for most use cases.</span></span><br><span class="line">    sourceMapFilename: <span class="string">'[file].map'</span>, <span class="comment">// Default</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// This is the source map filename template. It's default</span></span><br><span class="line">    <span class="comment">// format depends on the devtool option used. You don't</span></span><br><span class="line">    <span class="comment">// need to modify this often.</span></span><br><span class="line">    devtoolModuleFilenameTemplate:</span><br><span class="line">      <span class="string">'webpack:///[resource-path]?[loaders]'</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果使用了UglifyJsPlugin，同时还需要source maps，需要在这个插件中使用<code>sourceMap:true</code>开启source map。因为UglifyJS对源代码做了进一步转换，会破坏映射。对于其他一些plugins和loaders也是一样的，比如css-loader.</p>
<h2 id="SourceMapDevToolPlugin-and-EvalSourceMapDevToolPlugin"><a href="#SourceMapDevToolPlugin-and-EvalSourceMapDevToolPlugin" class="headerlink" title="SourceMapDevToolPlugin and EvalSourceMapDevToolPlugin"></a>SourceMapDevToolPlugin and EvalSourceMapDevToolPlugin</h2><p>如果对生成的source map需要更多的控制，可以使用<code>SmourceMapDevToolPlugin</code>或者<code>EvalSourceMapDevToolPlugin</code>。后者主要控制跟eval相关的source map。两个插件都可以更细粒度的控制source map，使用这些插件可以跳过对devtool的设置。<br>比如，webpack默认只会对.js和.css文件生成source maps，<code>SmourceMapDevToolPlugin</code>可以接受一个正则如/.(js|jsx|css)($|\?)/i，这样就可以允许对其他扩展名的文件也生成source map了。<br><code>EvalSourceMapDevToolPlugin</code>可以看成是<code>devtool:&quot;eval&quot;</code>的别名，同时能提供更灵活的控制。</p>
<h2 id="Source-Maps-for-Styling"><a href="#Source-Maps-for-Styling" class="headerlink" title="Source Maps for Styling"></a>Source Maps for Styling</h2><p>如果希望获得样式文件的source maps，可以开启sourceMap选项，如css-loader, sass-loader, less-loader。<br>当imports中使用相对路径时，css-loader会有一些<a href="https://github.com/webpack-contrib/css-loader/issues/232" target="_blank" rel="noopener">问题</a>，可以通过设置<code>output.publicPath</code>指向服务器url解决。</p>
<h2 id="conclusion"><a href="#conclusion" class="headerlink" title="conclusion"></a>conclusion</h2><ul>
<li><code>devtool: &quot;source-map&quot;</code>是映射质量最高，适于生产环境使用。</li>
<li><code>cheap-module-eval-source-map</code>适合用于开发环境。</li>
<li>如果生产环境中只需要stack traces，可以用<code>devtool: &quot;hidden-source-map&quot;</code>。可以捕获输出并利用第三方服务测试并解决问题。</li>
<li><code>SourceMapDevToolPlugin</code>和<code>EvalSourceMapDevToolPlugin</code>对source map 提供了更细粒度的控制。</li>
<li><code>source-map-loader</code> can come in handy if your dependencies provide source maps.</li>
<li>开启样式的source maps需要对你使用的每个样式相关的loader设置sourceMap选项</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/12/responsive-image/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ailsa">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ailsa's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/12/responsive-image/" itemprop="url">responsive images</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-12T19:24:34+08:00">2018-04-12</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/12/responsive-image/" class="leancloud_visitors" data-flag-title="responsive images">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views:</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images" target="_blank" rel="noopener">Responsive Images</a>学习笔记</p>
<h2 id="why-need-responsive-images"><a href="#why-need-responsive-images" class="headerlink" title="why need responsive images"></a>why need responsive images</h2><p>假设我们在做一个网页，页面上需要一些图片，在PC端打开这个网页，图片是很清晰很合适的。此时被告知，这个页面在移动端也需要用到，把页面调成手机模式，可以发现屏幕变窄了，图片变得很小而且不清晰。可以看下mdn的一个例子：<a href="https://mdn.github.io/learning-area/html/multimedia-and-embedding/responsive-images/not-responsive.html" target="_blank" rel="noopener">no responsive example</a>,<a href="https://mdn.github.io/learning-area/html/multimedia-and-embedding/responsive-images/responsive.html" target="_blank" rel="noopener">responsive example</a></p>
<p>art direction problem: 当在一个狭窄的屏幕，或者中等屏幕比如平板上浏览网页时，显示一个裁剪后的图片会更好。比如，我们在PC上有一张人物在中间，背景较大，人物较小的图片，当放到移动端查看时，图片被缩小，人物就几乎看不清楚了，最好是在手机端显示一个人物放大的裁剪后的图片。<br>resolution switch problem: 如果在一个较小的移动屏幕上观看，就不需要使用那么大的图片，这就是所谓的分辨率切换问题。对比于矢量图片，栅格图片如果显示的尺寸大于本身的尺寸时，视觉效果是很糟糕的；当显示尺寸小于本身的尺寸时，对带宽又是一种浪费，尤其对于手机用户，一个小尺寸的图片就能显示很好的效果，却要浪费带宽去下载一个为PC设计的大图片。所以较理想的方案是根据不同的设备尺寸显示不同大小的图片。你可能会说矢量图片可以解决上面的问题，矢量图片一般都较小，并且对于简单的图形、模式、界面元素等等都表现的很好，但是对于一些复杂的图像，创建矢量图会变得很复杂。</p>
<p>上面的这些问题在web开发前期是不存在的，因为那时候上网的主要设备是台式机和笔记本，所以浏览器引擎和早期的规范都没考虑这个问题。响应式图片技术是最近才实现的技术，给浏览器提供多个图片文件，展示同样的内容但是不同的像素大小(resolution switching)，也可以是在不同的空间使用不同的图片(art direction)。</p>
<h2 id="Create-Responsive-Images"><a href="#Create-Responsive-Images" class="headerlink" title="Create Responsive Images"></a>Create Responsive Images</h2><h3 id="Resolution-Switching"><a href="#Resolution-Switching" class="headerlink" title="Resolution Switching"></a>Resolution Switching</h3><p>我们将要使用<code>&lt;img&gt;</code>元素来创建响应式图片，根据设备大小显示合适大小的图片。一般在使用img时，主要指定src和alt属性：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"logo.jpg"</span> <span class="attr">alt</span>=<span class="string">"logo"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>下面要介绍两个新的属性：<code>srcset</code>、 <code>sizes</code>,提供一些带提示的图片源，帮助浏览器选择更合适的图片展示。</p>
<h4 id="srcset"><a href="#srcset" class="headerlink" title="srcset"></a>srcset</h4><p><code>srcset</code>提供一系列可供选择的图片字符串，字符串的组合为：</p>
<ul>
<li>图片路径</li>
<li>可选描述符如下，每个描述符前有空格<ul>
<li>宽度描述符：一个后跟w的正数。宽度描述符除以<code>sizes</code>属性中给定的size，用以计算像素密度。</li>
<li>像素密度描述符：一个后跟x的正浮点数。</li>
</ul>
</li>
</ul>
<p>如果没有指定任何描述符，会分配默认的描述符<code>1x</code>。</p>
<p>不要在srcset属性中混合宽度描述符和像素密度描述符，或者指定重复的描述符，比如两张图片都使用2x作为描述符。<br>这为浏览器提供了很大的选择余地，浏览器可以根据用户偏好或者带宽条件，从提供的图片源中选择最合适的一张图片显示。</p>
<h4 id="sizes"><a href="#sizes" class="headerlink" title="sizes"></a>sizes</h4><p><code>sizes</code>提供一系列图片size的字符串，字符串组合为：</p>
<ul>
<li>媒体查询条件，最后一个字符串省略这项，作为默认size</li>
<li>a source size value, 用以指定图片的预期显示大小。</li>
</ul>
<p>当<code>srcset</code>中提供了宽度描述符，用户浏览器会根据当前的source size来选择<code>srcset</code>中提供的图片。被选择的source size会影响图片的原始大小（如果没有使用CSS样式）。如果没有提供srcset属性，或者srcset属性中没有宽度描述符或包含无效宽度描述符，<code>sizes</code>属性就不起作用。</p>
<h4 id="width-descriptor"><a href="#width-descriptor" class="headerlink" title="width descriptor"></a>width descriptor</h4><p>eg: <a href="https://mdn.github.io/learning-area/html/multimedia-and-embedding/responsive-images/responsive.html" target="_blank" rel="noopener">responsive-width</a><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">srcset</span>=<span class="string">"320w.jpg 320w,</span></span></span><br><span class="line"><span class="tag"><span class="string">             480w.jpg 480w,</span></span></span><br><span class="line"><span class="tag"><span class="string">             800w.jpg 800w"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">sizes</span>=<span class="string">"(max-width: 320px) 280px,</span></span></span><br><span class="line"><span class="tag"><span class="string">            (max-width: 480px) 440px,</span></span></span><br><span class="line"><span class="tag"><span class="string">            800px"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">src</span>=<span class="string">"800w.jpg"</span> <span class="attr">alt</span>=<span class="string">"Elva dressed as a fairy"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>上面代码的意思是：<br>srcset:向浏览器提供了三张图片，宽度分别为320px, 480px，800px。<br>sizes:当设备大小小于320px时，图片预计显示大小为280px；当设备大小小于480px时，图片预计显示大小为440px；其他设备大小，图片预计显示大小为800px。</p>
<p>浏览器的选择过程：</p>
<ol>
<li>查询当前设备宽度</li>
<li>根据sizes中的媒体查询条件，找到第一个为true的条件下图片预计显示大小</li>
<li>加载srcset中图片宽度最靠近步骤2中获取的预计图片显示大小的图片</li>
</ol>
<p>所以如果一个设备宽度为480px的浏览器加载这个网页，(max-width: 480px)的媒体查询条件满足，图片预计展示大小为440px，srcset属性中最靠近440px的图片为480w.jpg，因此浏览器会加载480w.jpg。假设800px的图片大小为128kb，480px的图片大小为63kb，就可以节约65kb。所以当一个网页上有很多图片时，使用响应式图片就可以为手机用户节约很多带宽。<br>对于不支持srcset和sizes属性的旧浏览器，浏览器就会忽略这两个属性，加载src中定义的图片。</p>
<p><strong>note:</strong>一些手机浏览器会使用错误的视口宽度，它们会加载一个适合更大视口上加载的网页，然后展示缩小的页面，这样的话很不适合响应式图片的设计。因此我们可以在<code>head</code>中使用<code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;&gt;</code>来强制手机浏览器使用真实的视口宽度来加载网页。</p>
<h4 id="pixel-density-descriptor"><a href="#pixel-density-descriptor" class="headerlink" title="pixel density descriptor"></a>pixel density descriptor</h4><p>如果需要支持多种显示分辨率，但每个人在屏幕上看到的大小都跟真实的大小一样，可以允许浏览器选择合适的分辨率图像。这时可以使用像素密度描述符描述<code>srcset</code>中的图片源，并省略<code>sizes</code>属性。可以看这个例子：<a href="https://mdn.github.io/learning-area/html/multimedia-and-embedding/responsive-images/srcset-resolutions.html" target="_blank" rel="noopener">responsive-resolutions</a><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">srcset</span>=<span class="string">"320w.jpg,</span></span></span><br><span class="line"><span class="tag"><span class="string">             480w.jpg 1.5x,</span></span></span><br><span class="line"><span class="tag"><span class="string">             640w.jpg 2x"</span></span></span><br><span class="line"><span class="tag">     <span class="attr">src</span>=<span class="string">"640w.jpg"</span> <span class="attr">alt</span>=<span class="string">"Elva dressed as a fairy"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在这个例子中，我们不需要<code>sizes</code>，因为浏览器只会根据分辨率来选择图片，如果浏览器分辨率为1，加载320w.jpg；浏览器分辨率为1.5时，加载480w.jpg；浏览器分辨率为2时，加载640w.jpg。</p>
<h3 id="Art-direction"><a href="#Art-direction" class="headerlink" title="Art direction"></a>Art direction</h3><p>总的来说，art direction problem 涉及到要改变图片来适应不同的图片展示大小。还是一开始那个例子，人物照背景很大，放到手机端，人物就会很小，可以放一张裁剪的，人物被放大的图片在手机端展示。可以使用<code>&lt;picture&gt;</code>来实现。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">media</span>=<span class="string">"(max-width: 799px)"</span> <span class="attr">srcset</span>=<span class="string">"480w.jpg"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">media</span>=<span class="string">"(min-width: 800px)"</span> <span class="attr">srcset</span>=<span class="string">"800w.jpg"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"1240w.jpg"</span> <span class="attr">alt</span>=<span class="string">"Chris standing up holding his daughter Elva"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li><code>&lt;source&gt;</code>的media属性，起到媒体查询的作用，上面的例子表示：当设备宽度小于799px时，加载480w.jpg，如果设备宽度大于800px，加载800w.jpg。</li>
<li>srcset属性包含图片路径，跟之前的<code>&lt;img&gt;</code>一样，<code>&lt;source&gt;</code>也有srcset属性，可以接受一组图片路径，也有sizes属性。因此<code>&lt;picture&gt;</code>可以提供不同的图片，同时还可以提供不同分辨率下显示的图片。但是不要同时使用sizes和media属性。</li>
<li>在<code>&lt;/picture&gt;</code>前必须有<code>&lt;img&gt;</code>元素，带有src和alt属性，不然就不会有图片显示。当所有查询条件都不满足时，会展示img中的元素。</li>
</ul>
<p>我们还可以给<code>&lt;picture&gt;</code>提供type属性，存储MIME类型，对于不支持的文件类型，浏览器可以立即放弃：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">type</span>=<span class="string">"image/svg+xml"</span> <span class="attr">srcset</span>=<span class="string">"pyramid.svg"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">type</span>=<span class="string">"image/webp"</span> <span class="attr">srcset</span>=<span class="string">"pyramid.webp"</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"pyramid.png"</span> <span class="attr">alt</span>=<span class="string">"regular pyramid built from four equilateral triangles"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>除非需要art direction，否则不要使用media属性</li>
<li>在<code>&lt;source&gt;</code>中，srcset只能引入type类型定义的图像类型</li>
<li>需要的时候，也可以使用srcset和sizes定义一系列图片源</li>
</ul>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/source" target="_blank" rel="noopener">source属性</a></p>
<h2 id="webpack-tools"><a href="#webpack-tools" class="headerlink" title="webpack tools"></a>webpack tools</h2><p><code>responsive-loader</code>和<code>resize-image-loader</code>可以生成不同尺寸的图片作为srcset，对于根据设备宽度选择图片时，我们只需要一张图片，webpack就可以在引入时帮我们生成多个size的图片，作为srcset图片源。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images" target="_blank" rel="noopener">Responsive Images</a></li>
<li><a href="http://www.zhangxinxu.com/wordpress/2015/11/anatomy-of-responsive-images/" target="_blank" rel="noopener">图解img picture使用场景</a></li>
<li><a href="http://www.zhangxinxu.com/wordpress/2014/10/responsive-images-srcset-size-w-descriptor/" target="_blank" rel="noopener">响应式图片</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img" target="_blank" rel="noopener"><code>&lt;img&gt;</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/source" target="_blank" rel="noopener"><code>&lt;source&gt;</code></a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/picture" target="_blank" rel="noopener"><code>&lt;picture&gt;</code></a></li>
<li><a href="https://www.npmjs.com/package/responsive-loader" target="_blank" rel="noopener">responsive-loader</a></li>
<li><a href="https://www.npmjs.com/package/resize-image-loader" target="_blank" rel="noopener">resize-image-loader</a></li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/11/surviveJS-webpack-loadingAssets/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ailsa">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ailsa's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/11/surviveJS-webpack-loadingAssets/" itemprop="url">surviveJS-webpack-loadingAssets学习笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-11T16:15:57+08:00">2018-04-11</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/11/surviveJS-webpack-loadingAssets/" class="leancloud_visitors" data-flag-title="surviveJS-webpack-loadingAssets学习笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views:</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong><a href="https://survivejs.com/webpack/loading/" target="_blank" rel="noopener">surviveJS-webpack-loadingAssets</a></strong></p>
<h2 id="Loader-definitions"><a href="#Loader-definitions" class="headerlink" title="Loader definitions"></a>Loader definitions</h2><h3 id="Enforcing-Order"><a href="#Enforcing-Order" class="headerlink" title="Enforcing Order"></a>Enforcing Order</h3><p>loader的使用顺序是从右到左，从下到上，但是我们仍然可以通过enforce字段定义该loader的执行是优先于普通loader还是落后于普通loader。可选的值为<code>pre</code>和<code>post</code>。<br>举个例子：eslint-loader要优先于其他loader的执行<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// Conditions</span></span><br><span class="line">  test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  enforce: <span class="string">"pre"</span>, <span class="comment">// "post" too</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// Actions</span></span><br><span class="line">  use: <span class="string">"eslint-loader"</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>如果我们把需要的loader链接起来，也可以不使用enforce使得该loader优先于其他loader的执行。使用enforce就可以将loader分成几个阶段，也更容易组合。</p>
<h3 id="Parsing-parameters-to-a-Loader"><a href="#Parsing-parameters-to-a-Loader" class="headerlink" title="Parsing parameters to a Loader"></a>Parsing parameters to a Loader</h3><p>推荐使用下面这种方式<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  include: PATHS.app,</span><br><span class="line"></span><br><span class="line">  use: [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">"babel-loader"</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        presets: [<span class="string">"env"</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// Add more loaders here</span></span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h3 id="Alternate-ways-to-Match-files"><a href="#Alternate-ways-to-Match-files" class="headerlink" title="Alternate ways to Match files"></a>Alternate ways to Match files</h3><ul>
<li>resource: 匹配资源路径，匹配时包括query. eg: <code>resource: /inline/</code>, <code>/path/foo.inline.js</code>, <code>/path/bar.png?inline</code></li>
<li>issure: Match against a resource requested from the match. Example:<code>issure: /bar.js/</code>, then <code>/path/foo.png</code> would match if it was requested from <code>/path/bar.js</code>. </li>
<li>resourcePath: 匹配资源路径，不包括query. eg: <code></code>resourcePath: /inline/<code>,</code>/path/foo.inline.png`</li>
<li>resourceQuery: 匹配query. eg: <code>resourceQuery: /inline/</code>, <code>/path/foo.png?inline</code></li>
</ul>
<p>还可以结合一些布尔值使用：</p>
<ul>
<li>not: 条件不匹配时匹配</li>
<li>and: 数组，仅当所有条件都匹配时匹配</li>
<li>or: 数组，任意条件匹配时匹配</li>
</ul>
<h3 id="Loading-Based-on-ResourceQuery"><a href="#Loading-Based-on-ResourceQuery" class="headerlink" title="Loading Based on ResourceQuery"></a>Loading Based on ResourceQuery</h3><p>oneOf只使用嵌套规则之一<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.png$/</span>,</span><br><span class="line">  oneOf: [</span><br><span class="line">    &#123;</span><br><span class="line">      resourceQuery: <span class="regexp">/inline/</span>,</span><br><span class="line">      use: <span class="string">"url-loader"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      resourceQuery: <span class="regexp">/external/</span>,</span><br><span class="line">      use: <span class="string">"file-loader"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h3 id="Loading-Based-on-Issuer"><a href="#Loading-Based-on-Issuer" class="headerlink" title="Loading Based on Issuer"></a>Loading Based on Issuer</h3><p>issuer可以用来控制资源是从哪里引入的。下面这个例子匹配当JS文件引入了一个CSS文件时。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.css$/</span>,</span><br><span class="line"></span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      issuer: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      use: <span class="string">"style-loader"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      use: <span class="string">"css-loader"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>和<code>not</code>结合：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.css$/</span>,</span><br><span class="line"></span><br><span class="line">  rules: [</span><br><span class="line">    <span class="comment">// CSS imported from other modules is added to the DOM</span></span><br><span class="line">    &#123;</span><br><span class="line">      issuer: &#123; <span class="attr">not</span>: <span class="regexp">/\.css$/</span> &#125;,</span><br><span class="line">      use: <span class="string">"style-loader"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// Apply css-loader against CSS imports to return CSS</span></span><br><span class="line">    &#123;</span><br><span class="line">      use: <span class="string">"css-loader"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Understanding-Loader-Behavior"><a href="#Understanding-Loader-Behavior" class="headerlink" title="Understanding Loader Behavior"></a>Understanding Loader Behavior</h3><p>可以通过监控loader来了解他们的行为。<code>loader-runner</code>可以在隔离webpack环境下运行Loader. <code>inspect-loader</code>可以查看loaders之间传递的内容，不需要在node_modules中插入console.logs，只需要把这个Loader放在你的配置中就可以监控这里的流程。</p>
<h2 id="Loading-Images"><a href="#Loading-Images" class="headerlink" title="Loading Images"></a>Loading Images</h2><p><code>url-loader</code>可以将你的图片输出为base64的字符串，打包到你的JS bundle中。这种处理以增大JS bundle大小为代价，减少了请求数量。在开发环境使用是可以的，但是生产环境中需要更加优化的方式。<br><code>file-loader</code>会将Image输出为文件，并返回路径。<code>file-loader</code>也适用于其他类型的assets，比如fonts。</p>
<h3 id="Setting-up-url-loader"><a href="#Setting-up-url-loader" class="headerlink" title="Setting up url-loader"></a>Setting up url-loader</h3><p><code>url-loader</code>有一个<code>limit</code>选项，可以在达到绝对限制后，使用<code>file-loader</code>延迟图像输出。如果使用<code>limit</code>选项，那你的项目中需要同时安装有<code>url-loader</code>和<code>file-loader</code>。配置成功后，webpack会解析样式文件中所有的<code>url()</code>表达式。如果在超过limit限制后，不希望用<code>file-loader</code>处理，可以设置<code>fallback:&#39;some-loader&#39;</code>，超过限制后便可以使用设置的Loader来处理图片。<br>下面的例子是配置25KB以下的图片使用<code>url-loader</code>处理，超过25KB的使用<code>file-loader</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(jpg|png)$/</span>,</span><br><span class="line">  use: &#123;</span><br><span class="line">    loader: <span class="string">"url-loader"</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      limit: <span class="number">25000</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h3 id="Setting-up-file-loader"><a href="#Setting-up-file-loader" class="headerlink" title="Setting up file-loader"></a>Setting up file-loader</h3><p>如果希望所有图片都不使用内联方式，可以直接使用<code>file-loader</code>，默认情况下<code>file-loader</code>会返回MD5哈希和原来的扩展名.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.(jpg|png)$/</span>,</span><br><span class="line">  use: &#123;</span><br><span class="line">    loader: <span class="string">"file-loader"</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      name: <span class="string">"./images/[path][name].[hash].[ext]"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h3 id="Integrating-Images-to-the-Project"><a href="#Integrating-Images-to-the-Project" class="headerlink" title="Integrating Images to the Project"></a>Integrating Images to the Project</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add file-loader url-loader -D</span><br></pre></td></tr></table></figure>
<p>webpack.parts.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">exports.loadImages = <span class="function">(<span class="params">&#123; include, exclude, options &#125; = &#123;&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(png|jpg)$/</span>,</span><br><span class="line">        include,</span><br><span class="line">        exclude,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">"url-loader"</span>,</span><br><span class="line">          options,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>使用<code>limit</code>时，<code>url-loader</code>会将额外的配置传给<code>file-loader</code>.<br>webpack.config.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> productionConfig = merge([</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  parts.loadImages(&#123;</span><br><span class="line">    options: &#123;</span><br><span class="line">      limit: <span class="number">15000</span>,</span><br><span class="line">      name: <span class="string">"[name].[ext]"</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> developmentConfig = merge([</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  parts.loadImages(),</span><br><span class="line"></span><br><span class="line">]);</span><br></pre></td></tr></table></figure></p>
<p>上面的例子是在开发环境中使用<code>url-loader</code>,在生产环境中使用<code>url-loader</code>和<code>file-loader</code>.<br>开发环境：<br><img src="/2018/04/11/surviveJS-webpack-loadingAssets/url-console.png" alt=""><br><img src="/2018/04/11/surviveJS-webpack-loadingAssets/url-loader.png" alt=""><br>生产环境：<br><img src="/2018/04/11/surviveJS-webpack-loadingAssets/file-console.png" alt=""><br><img src="/2018/04/11/surviveJS-webpack-loadingAssets/file-loader.png" alt=""></p>
<p>在生产环境中还可以将图片压缩，可以使用<code>image-webpack-loader</code>,<code>svgo-loader</code>(SVG specific), <code>imagemin-webpack-plugin</code>。这类loader都应该先处理数据，因此需要将其放在<code>use</code>列表的最下面。</p>
<h3 id="utilizing-srcset"><a href="#utilizing-srcset" class="headerlink" title="utilizing srcset"></a>utilizing srcset</h3><p><code>responsive-loader</code>和<code>resize-image-loader</code>可以生成srcset，srcset可以使浏览器更好的控制加载什么样的图片，性能也更好。</p>
<blockquote>
<p>A webpack loader for responsive images. Creates multiple images from one source image, and returns a srcset. For more information on how to use srcset, read <strong><a href="https://css-tricks.com/responsive-images-youre-just-changing-resolutions-use-srcset/" target="_blank" rel="noopener">Responsive Images</a></strong>: If you’re just changing resolutions, use srcset.. Browser support is <a href="https://caniuse.com/#search=srcset" target="_blank" rel="noopener">pretty good</a></p>
</blockquote>
<h3 id="Loading-sprites"><a href="#Loading-sprites" class="headerlink" title="Loading sprites"></a>Loading sprites</h3><p><code>webpack-spritesmith</code> converts provided images into a sprite sheet and Sass/Less/Stylus mixins.<br>需要设置<code>spritesmithPlugin</code><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> <span class="string">"~sprite.sass"</span>;</span><br><span class="line"></span><br><span class="line">.close-button &#123;</span><br><span class="line">  sprite($close);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.open-button &#123;</span><br><span class="line">  sprite($open);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Using-placeholders"><a href="#Using-placeholders" class="headerlink" title="Using placeholders"></a>Using placeholders</h3><p><code>image-trace-loader</code>加载图片，输出类似<code>image/svg+xml</code> URL encoded数据。可以结合<code>file-loader</code>和<code>url-loader</code>使用，当真实图片还未完全加载时展示placeholder.<br><code>lqip-loader</code>会使用模糊的图片做Placeholder.<br>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">exports.loadImage = <span class="function">(<span class="params">&#123; include, exclude, options &#125; = &#123;&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(jpg|png)$/</span>,</span><br><span class="line">        include,</span><br><span class="line">        exclude,</span><br><span class="line">        use: [</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'image-trace-loader'</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'url-loader'</span>,</span><br><span class="line">            options,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>在webpack.config.js中这样设置会对所有的图片都起作用，也可以不在webpack.config.js中配置，在引入图片时加入loader，如下面的示例：</p>
<p>component.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (text = <span class="string">'Hello world'</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> image = <span class="built_in">require</span>(<span class="string">'!!image-trace-loader?color=#BBCBD1&amp;background=#FFF!./logo.png'</span>);</span><br><span class="line">  <span class="keyword">const</span> img1 = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">  <span class="keyword">const</span> img2 = <span class="built_in">document</span>.createElement(<span class="string">'img'</span>);</span><br><span class="line">  <span class="keyword">const</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line">  img1.src = image.trace;</span><br><span class="line">  img1.className = <span class="string">'trace'</span>;</span><br><span class="line">  div.appendChild(img1);</span><br><span class="line"></span><br><span class="line">  img2.src = image.src;</span><br><span class="line">  img2.className = <span class="string">'image'</span>;</span><br><span class="line">  div.appendChild(img2);</span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    img2.className = <span class="string">'image loaded'</span>;</span><br><span class="line">  &#125;, <span class="number">500</span> + <span class="built_in">Math</span>.random() * <span class="number">1500</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> div;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>main.css<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">transition</span>: opacity <span class="number">1000ms</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.image</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.loaded</span> &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/04/11/surviveJS-webpack-loadingAssets/gray.png" alt=""><br>图片会先由黑白的渐变为正常的图片。</p>
<h3 id="Getting-Image-Dimentions"><a href="#Getting-Image-Dimentions" class="headerlink" title="Getting Image Dimentions"></a>Getting Image Dimentions</h3><p><code>image-size-loader</code>可以获取Image的尺寸，类型等信息。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = <span class="built_in">require</span>(<span class="string">"./image.png"</span>);</span><br><span class="line"><span class="comment">// =&gt; &#123;width: 500, height: 700, type: "png", src: __webpack_public_path__ + "image.png", bytes: 1234&#125;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Referencing-to-Images"><a href="#Referencing-to-Images" class="headerlink" title="Referencing to Images"></a>Referencing to Images</h3><p>如果配置了<code>css-loader</code>,webpack可以通过<code>@import</code>,<code>url()</code>,从样式表中找到图片。同时我们也可以在代码中使用，这时需要显式的引入这张图片。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> src <span class="keyword">from</span> <span class="string">"./avatar.png"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use the image in your code somehow now</span></span><br><span class="line"><span class="keyword">const</span> Profile = <span class="function"><span class="params">()</span> =&gt;</span> &lt;img src=&#123;src&#125; /&gt;;</span><br></pre></td></tr></table></figure></p>
<p>如果使用的是react，可以使用<code>babel-plugin-transform-react-jsx-img-import</code>自动生成require,代码就可以这样写：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Profile = <span class="function"><span class="params">()</span> =&gt;</span> &lt;img src=<span class="string">"avatar.png"</span> /&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="Images-and-css-loader-source-map-gotcha"><a href="#Images-and-css-loader-source-map-gotcha" class="headerlink" title="Images and css-loader source map gotcha"></a>Images and css-loader source map gotcha</h3><p>如果使用了images，并且允许css-loader的sourceMap，需要设置<code>output.publicPath</code>为指向development server的绝对值。like:<code>publicPath: &#39;http://0.0.0.0:8080/&#39;</code></p>
<h2 id="Loading-javascript"><a href="#Loading-javascript" class="headerlink" title="Loading javascript"></a>Loading javascript</h2><p>一些ES2015的语法在旧浏览器中会不支持，因此可以使用<code>Babel</code>–一个javascript编译器，支持Es2015的语法。可以通过<code>babel-loader</code>使用Babel，</p>
<blockquote>
<p>Connecting Babel with a project allows you to process webpack configuration through it. To achieve this, name your webpack configuration using the webpack.config.babel.js convention. interpret package enables this, and it supports other compilers as well.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add babel-loader babel-core -D</span><br></pre></td></tr></table></figure>
<p>webpack.prats.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">exports.loadJavaScript = <span class="function">(<span class="params">&#123; include, exclude &#125; = &#123;&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        include,</span><br><span class="line">        exclude,</span><br><span class="line">        use: <span class="string">"babel-loader"</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commonConfig = merge([</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  parts.loadJavaScript(&#123; <span class="attr">include</span>: PATHS.app &#125;),</span><br><span class="line"></span><br><span class="line">]);</span><br></pre></td></tr></table></figure></p>
<h3 id="Setting-up-babelrc"><a href="#Setting-up-babelrc" class="headerlink" title="Setting up .babelrc"></a>Setting up .babelrc</h3><blockquote>
<p>At a minimum, you need <code>babel-preset-env</code>. It’s a Babel preset that enables the required plugins based on the optional environment definition you pass to it.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add babel-preset-env -D</span><br></pre></td></tr></table></figure>
<p>webpack默认支持ES2015的modules，因此可以告知babel跳过处理modules。但是跳过处理modules可能会破坏webpack的HMR机制，然而生产环境并不会受到影响。<br>.babelrc<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"presets"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"modules"</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="polyfilling-features"><a href="#polyfilling-features" class="headerlink" title="polyfilling features"></a>polyfilling features</h3><p><code>babel-preset-env</code>可以为一些旧浏览器polyfill一些语言特性，但是需设置<code>useBuiltIns: true</code>并安装<code>babel-polyfill</code>，需要将其引入你的项目或者入口（<code>app:[&quot;babel-polyfill&quot;, PATHS.app]</code>）。<code>babel-preset-env</code>根据你的浏览器定义重写import，并加载需要的polyfills。<br><code>babel-polyfill</code>会用类似Promise对象这种污染全局环境，可以用<a href="https://babeljs.io/docs/plugins/transform-runtime/" target="_blank" rel="noopener"><code>transform-runtime</code></a>来解决。</p>
<h3 id="Enabling-Presets-and-Plugins-per-Environment"><a href="#Enabling-Presets-and-Plugins-per-Environment" class="headerlink" title="Enabling Presets and Plugins per Environment"></a>Enabling Presets and Plugins per Environment</h3><p><code>Babel</code>可以通过env选项控制哪些环境下使用哪些presets和plugins。<code>env</code>会检查<code>NODE_ENV</code>和<code>BABEL_ENV</code>,并根据他们在编译中使用不同的presets和plugins. 如果设置了<code>BABEL_ENV</code>,会覆盖<code>NODE_ENV</code>.<br>.babelrc<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">"env"</span>: &#123;</span><br><span class="line">    <span class="string">"development"</span>: &#123;</span><br><span class="line">      <span class="string">"plugins"</span>: [</span><br><span class="line">        <span class="string">"annotate-console-log"</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以用webpack环境来调整Babel环境：<br>webpack.config.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">mode</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  process.env.BABEL_ENV = mode;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>Babel允许你控制项目需要支持的浏览器，它可以编译ES2015+特性使得老的浏览器能够支持。<code>babel-preset-env</code>可以根据你要支持的浏览器定义来选择要编译的特性和应用哪些polyfills。</li>
<li>使用Babel可以体验一些实验性语言特性，可以找到很多plugins来提高开发体验和项目性能。</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/10/emacs-keys/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ailsa">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ailsa's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/10/emacs-keys/" itemprop="url">emacs keys</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-10T10:28:37+08:00">2018-04-10</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/工具/" itemprop="url" rel="index"><span itemprop="name">工具</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/10/emacs-keys/" class="leancloud_visitors" data-flag-title="emacs keys">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views:</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>记录一些常用的spacemacs快捷键<br>C 代表 Ctrl<br>M 代表 Option</p>
<h2 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// 退出</span><br><span class="line">退出emacs: C x C c</span><br><span class="line">退出当前操作：C g</span><br><span class="line"></span><br><span class="line">// 光标移动</span><br><span class="line">上一行：C p</span><br><span class="line">下一行：C n</span><br><span class="line">右移：C f</span><br><span class="line">右移一个单词：M f</span><br><span class="line">左移：C b</span><br><span class="line">左移一个单词：M b</span><br><span class="line">行首：C a</span><br><span class="line">行尾：C e</span><br><span class="line">删除光标后的单词：M d</span><br><span class="line">删除光标前的单词：M delete</span><br><span class="line">删除一个字母：C d</span><br><span class="line">删除某一行光标后的所有内容：C k</span><br><span class="line">光标所在区域定位到页面中间：C l</span><br><span class="line">光标移动到页面顶部：M shift &lt;</span><br><span class="line">光标移动到页面底部：M shift &gt;</span><br><span class="line">选中光标所在的单词：M m M w  扩大选中区域：w  缩小选中区域：V</span><br><span class="line">选中光标所在chunk: M h</span><br><span class="line"></span><br><span class="line">emacs黏贴：C y</span><br><span class="line">emacs剪切：C w</span><br><span class="line">emacs复制：M w</span><br><span class="line">全局复制：M m o y</span><br><span class="line"></span><br><span class="line">撤销操作：C -</span><br><span class="line">反撤销：C x u      q(quit)</span><br><span class="line"> </span><br><span class="line">选择模式：C space</span><br><span class="line">操作：M m M l  往右缩进：space   往左缩进：delete</span><br><span class="line"></span><br><span class="line">打开，新建文件：C x C f</span><br><span class="line">保存文件：C x C s</span><br></pre></td></tr></table></figure>
<h2 id="dired-mode"><a href="#dired-mode" class="headerlink" title="dired mode"></a>dired mode</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">打开dired mode: C x C j</span><br><span class="line">删除光标所在文件：D</span><br><span class="line">复制光标所在文件：C</span><br><span class="line">重命名或移动光标所在文件：R</span><br><span class="line">上一层目录：shift ^</span><br><span class="line">标记当前文件：m 若要标记多个文件: C space选择文件  m 标记</span><br><span class="line">取消标记光标所在文件：u 若要取消多个文件标记：C space选择文件 u 取消</span><br><span class="line"></span><br><span class="line">切换工程：C c p p</span><br><span class="line">切换到前一个buffer: M m tab</span><br><span class="line">查看所有打开的文件：M m f r</span><br></pre></td></tr></table></figure>
<h2 id="查找操作"><a href="#查找操作" class="headerlink" title="查找操作"></a>查找操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查找当前项目下的单词：C space 选择单词  / 开始搜索</span><br><span class="line">查找当前项目下的文件：C c p f</span><br><span class="line">查找当前文件下光标所在的单词：C c d(自定义的)</span><br><span class="line">查找当前文件下的单词：C s input word</span><br><span class="line">查找当前项目下某个路径范围内的单词：C c s 输入-G路径 单词 即可搜索路径内的单词</span><br></pre></td></tr></table></figure>
<h2 id="窗口操作"><a href="#窗口操作" class="headerlink" title="窗口操作"></a>窗口操作</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">右侧打开窗口：M m w v</span><br><span class="line">循环切换窗口：C x o </span><br><span class="line">多个窗口中保留当前光标所在窗口，关闭其他窗口：C x 1</span><br><span class="line">退出当前光标所在窗口：C x 0</span><br><span class="line">neotree上右侧打开窗口：shift |</span><br></pre></td></tr></table></figure>
<h2 id="magit"><a href="#magit" class="headerlink" title="magit"></a>magit</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">打开操作界面：M m g s</span><br><span class="line">折叠当前光标下的文件：tab 查看上一个chunk：p 查看下一个chunk: n 进入这个文件：enter</span><br><span class="line">缓存当前光标下的文件：s</span><br><span class="line">提交：cc</span><br><span class="line">提交页面放弃提交操作：C c C k</span><br><span class="line">撤销缓存当前光标下的文件：u</span><br><span class="line">放弃当前文件操作：k</span><br><span class="line">刷新：g</span><br><span class="line">帮助：shift ?</span><br><span class="line">git blame：M m g b  q(quit)</span><br><span class="line">查看当前文件的History：M m g t</span><br><span class="line">剪切commit号：M w</span><br></pre></td></tr></table></figure>
<h2 id="eslint"><a href="#eslint" class="headerlink" title="eslint"></a>eslint</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看eslint error: C c ! p/n/l</span><br><span class="line">查看底部出现的所有提示：M m w p m</span><br></pre></td></tr></table></figure>
<h2 id="help"><a href="#help" class="headerlink" title="help"></a>help</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查询函数：C h f</span><br><span class="line">执行命令：M x</span><br><span class="line">上一页：C v</span><br><span class="line">下一页：M v</span><br><span class="line">教程：C h t</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/09/surviveJS-webpack-styling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ailsa">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ailsa's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/09/surviveJS-webpack-styling/" itemprop="url">surviveJS-webpack-styling学习笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-09T14:41:10+08:00">2018-04-09</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/09/surviveJS-webpack-styling/" class="leancloud_visitors" data-flag-title="surviveJS-webpack-styling学习笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views:</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong><a href="https://survivejs.com/webpack/styling/" target="_blank" rel="noopener">surviveJS-webpack-styling</a></strong></p>
<h2 id="Loading-Styles"><a href="#Loading-Styles" class="headerlink" title="Loading Styles"></a>Loading Styles</h2><p>webpack默认是不支持加载CSS的，所以我们需要使用loaders和plugins来加载样式文件。<br>加载CSS，需要用到css-loader和style-loader。</p>
<blockquote>
<p> css-loader goes through possible @import and url() lookups within the matched files and treats them as a regular ES2015 import.If an @import points to an external resource, css-loader skips it as only internal resources get processed further by webpack.<br> style-loader injects the styling through a style element. The way it does this can be customized. It also implements the Hot Module Replacement interface providing pleasant development experience.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add style-loader css-loader -D</span><br></pre></td></tr></table></figure>
<p>webpack.parts.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">exports.loadCSS = <span class="function">(<span class="params">&#123; include, exclude &#125; = &#123;&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        include,</span><br><span class="line">        exclude,</span><br><span class="line"></span><br><span class="line">        use: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>loaders的执行顺序是从右到左，从下到上，也就是说这里的loader执行是先执行css-loader，然后再到style-loader，可以这样理解<code>style-loader(css-loader(input))</code><br>webpack.config.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> commonConfig = merge([</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  parts.loadCSS(),</span><br><span class="line"></span><br><span class="line">]);</span><br></pre></td></tr></table></figure></p>
<p>src/main.css<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: cornsilk;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>src/index.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"./main.css"</span>;</span><br></pre></td></tr></table></figure></p>
<p>这样样式就可以生效啦。</p>
<h3 id="Loading-Less"><a href="#Loading-Less" class="headerlink" title="Loading Less"></a>Loading Less</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">  use: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>, <span class="string">"less-loader"</span>],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="Loading-Sass"><a href="#Loading-Sass" class="headerlink" title="Loading Sass"></a>Loading Sass</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.scss$/</span>,</span><br><span class="line">  use: [<span class="string">"style-loader"</span>, <span class="string">"css-loader"</span>, <span class="string">"sass-loader"</span>],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><code>sass-loader</code>依赖于<code>node-sass</code>,所以项目还需要安装<code>node-sass</code>.</p>
<h3 id="Loading-Stylus-and-Yeticss"><a href="#Loading-Stylus-and-Yeticss" class="headerlink" title="Loading Stylus and Yeticss"></a>Loading Stylus and Yeticss</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  ...</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.styl$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">"style-loader"</span>,</span><br><span class="line">          <span class="string">"css-loader"</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">"stylus-loader"</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              use: [<span class="built_in">require</span>(<span class="string">"yeticss"</span>)],</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>还需要在项目中引入<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> <span class="string">"yeticss"</span></span><br><span class="line"><span class="comment">//or</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">"yeticss/components/type"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="PostCSS"><a href="#PostCSS" class="headerlink" title="PostCSS"></a>PostCSS</h3><p><a href="http://postcss.org/" target="_blank" rel="noopener">PostCSS</a>的插件系统可以将CSS转化为JS，相当于样式中的Babel。</p>
<blockquote>
<p>PostCSS allows you to inject functionality to CSS in through its plugin system. cssnext is an example of a collection of plugins for PostCSS that implements future features of CSS.</p>
</blockquote>
<p>下面这个例子是自动添加前缀.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    <span class="string">"style-loader"</span>,</span><br><span class="line">    <span class="string">"css-loader"</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">"postcss-loader"</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        plugins: <span class="function"><span class="params">()</span> =&gt;</span> ([</span><br><span class="line">          <span class="built_in">require</span>(<span class="string">"autoprefixer"</span>)(),</span><br><span class="line">        ]),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h3 id="cssnext"><a href="#cssnext" class="headerlink" title="cssnext"></a>cssnext</h3><p><a href="http://cssnext.io/" target="_blank" rel="noopener">cssnext</a>是postcss-loader的一个插件，可以体验一些未来的特性。可以通过postcss-cssnext来使用。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  use: &#123;</span><br><span class="line">    loader: <span class="string">"postcss-loader"</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      plugins: <span class="function"><span class="params">()</span> =&gt;</span> [<span class="built_in">require</span>(<span class="string">"postcss-cssnext"</span>)()],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<p>cssnext就包括了autoprefixer，所以使用cssnext就可以不用autoprefixer了。</p>
<h3 id="Understanding-Lookups"><a href="#Understanding-Lookups" class="headerlink" title="Understanding Lookups"></a>Understanding Lookups</h3><p>css-loader默认会处理相对路径的引入，但不会处理绝对路径的引入，类似<code>url(&quot;/static/img/demo.png&quot;)</code>。可以使用copy-webpack-plugin将文件拷贝都当前工程中。</p>
<h3 id="Processing-css-loader-imports"><a href="#Processing-css-loader-imports" class="headerlink" title="Processing css-loader imports"></a>Processing css-loader imports</h3><p>importLoaders用于告诉webpack,通过imports引入的文件在经过css-loader处理后还需要经过多少个loader。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    <span class="string">"style-loader"</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">"css-loader"</span>,</span><br><span class="line">      options: &#123;</span><br><span class="line">        importLoaders: <span class="number">1</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"sass-loader"</span>,</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h3 id="Loading-from-node-modules"><a href="#Loading-from-node-modules" class="headerlink" title="Loading from node_modules"></a>Loading from node_modules</h3><p>当需要从node_modules引入文件时，需要使用<code>~</code>告诉webpack这里不是默认的相对引入，webpack就会去node_modules查找，查找node_modules是默认行为，可以通过设置<code>resolve.modules</code>修改。<br>如果使用了postcss-loader，可以不用使用<code>~</code>也能实现引入。</p>
<h3 id="Enabling-source-map"><a href="#Enabling-source-map" class="headerlink" title="Enabling source map"></a>Enabling source map</h3><blockquote>
<p>To use source maps, you have to enable sourceMap boolean through each style loader you are using except for style-loader. You should also set <code>output.publicPath</code> to an absolute url that points to your development server.</p>
</blockquote>
<h2 id="Separating-CSS"><a href="#Separating-CSS" class="headerlink" title="Separating CSS"></a>Separating CSS</h2><p>现在的项目已经可以应用样式了，但是存在FOUC(flush of unstyled content)样式闪动问题，因为现在的样式是嵌在JS中的，浏览器需要花时间来加载JS，JS加载好后才能展示样式，所以会出现样式闪动。<br>我们可以把样式分离出来，浏览器就可以分开处理样式和JS，这样能避免样式闪烁。<br>可以对比下分离CSS前和分离后：<br><img src="/2018/04/09/surviveJS-webpack-styling/normal.png" alt=""><br><img src="/2018/04/09/surviveJS-webpack-styling/extract-css.png" alt=""><br>我们可以使用<a href="https://www.npmjs.com/package/extract-text-webpack-plugin" target="_blank" rel="noopener">ExtractTextPlugin</a>来汇总所有的CSS并输出到一个文件中。这个过程需要一个Loader来抽取CSS，然后plugin取出Loader抽取的CSS，并输出到一个文件中。ExtractTextPlugin不支持HMR.</p>
<h3 id="Setting-up-ExtractTextPlugin"><a href="#Setting-up-ExtractTextPlugin" class="headerlink" title="Setting up ExtractTextPlugin"></a>Setting up ExtractTextPlugin</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add extract-text-webpack-plugin@next -D</span><br></pre></td></tr></table></figure>
<p>ExtractTextPlugin包含一个Loader:<code>ExtractTextPlugin.extract</code>用来标记需要抽取的assets，plugin会基于这些标记来继续抽取输出的工作。<br><code>ExtractTextPlugin.extract</code>接受use和fallback。ExtractTextPlugin默认只会用use中定义的loader处理initial chunks的内容，对于其他的chunks使用fallback。除非设置allChunks:true, 否则不会处理split bundles。<br>如果你想要抽取Sass这种CSS，就需要给use传递多个Loader. use和fallback都接受loader。<br>webpack.parts.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">"extract-text-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line">exports.extractCSS = <span class="function">(<span class="params">&#123; include, exclude, use &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Output extracted CSS to a file</span></span><br><span class="line">  <span class="keyword">const</span> plugin = <span class="keyword">new</span> ExtractTextPlugin(&#123;</span><br><span class="line">    <span class="comment">// `allChunks` is needed to extract from extracted chunks as well.</span></span><br><span class="line">    allChunks: <span class="literal">true</span>,</span><br><span class="line">    filename: <span class="string">"styles/[name].css"</span>,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">      rules: [</span><br><span class="line">        &#123;</span><br><span class="line">          test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">          include,</span><br><span class="line">          exclude,</span><br><span class="line"></span><br><span class="line">          use: plugin.extract(&#123;</span><br><span class="line">            use,</span><br><span class="line">            fallback: <span class="string">"style-loader"</span>,</span><br><span class="line">          &#125;),</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [plugin],</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>webpack.config.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> productionConfig = merge([</span><br><span class="line">  parts.extractCSS(&#123;</span><br><span class="line">    use: <span class="string">"css-loader"</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> developmentConfig = merge([</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  parts.loadCSS(),</span><br><span class="line"></span><br><span class="line">]);</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/04/09/surviveJS-webpack-styling/extract-output.png" alt=""><br>在生产阶段将CSS抽取到一个文件中，JS bundle更小了，样式闪烁的问题也解决了。在开发阶段仍然使用普通的CSS加载方式，仍然可以享受HMR。</p>
<h2 id="Eliminating-Unused-CSS"><a href="#Eliminating-Unused-CSS" class="headerlink" title="Eliminating Unused CSS"></a>Eliminating Unused CSS</h2><p>一些CSS框架，比如bootstrap,你可能只是用了其中一小部分样式，但是打包的时候会将很多没用的样式都一起打包进来。我们希望能过滤一些无用的样式代码。<br><a href="https://www.npmjs.com/package/purifycss-webpack" target="_blank" rel="noopener">PurifyCSS</a> 可以通过分析文件实现这个功能。她会检查你的代码并找出哪些CSS classes是被使用了的。</p>
<blockquote>
<p>You have to be careful if you are using CSS Modules. You have to whitelist the related classes as discussed in purifycss-webpack readme.</p>
</blockquote>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>pure.css是一个小型的CSS库，我们可以引用这个库，再利用purifyCSS来过滤无用的CSS。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add pure.css</span><br></pre></td></tr></table></figure></p>
<p>index.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"purecss"</span></span><br></pre></td></tr></table></figure></p>
<p>src/component.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (text = <span class="string">"Hello world"</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> element = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  element.className = <span class="string">"pure-button"</span>;</span><br><span class="line"></span><br><span class="line">  element.innerHTML = text;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> element;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p><code>yarn run prod</code>查看下css文件大小：<br><img src="/2018/04/09/surviveJS-webpack-styling/nopurify.png" alt=""></p>
<p>引入purifycss<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add purifycss-webpack purify-css glob -D</span><br></pre></td></tr></table></figure></p>
<p><a href="https://www.npmjs.com/package/glob" target="_blank" rel="noopener">glob</a> match files using the patterns the shell uses, like stars and stuff.</p>
<p>webpack.parts.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> PurifyCSSPlugin = <span class="built_in">require</span>(<span class="string">"purifycss-webpack"</span>);</span><br><span class="line"></span><br><span class="line">exports.purifyCSS = <span class="function">(<span class="params">&#123; paths &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  plugins: [<span class="keyword">new</span> PurifyCSSPlugin(&#123; paths &#125;)],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>需要注意的是：purifycss插件必须用在extractCSS插件后，不然就不起作用了<br>webpack.config.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> glob = <span class="built_in">require</span>(<span class="string">"glob"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PATHS = &#123;</span><br><span class="line">  app: path.join(__dirname, <span class="string">"src"</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> productionConfig = merge([</span><br><span class="line">  ...</span><br><span class="line">  parts.extractCSS(&#123;<span class="attr">use</span>:<span class="string">'css-loader'</span>&#125;),</span><br><span class="line">  <span class="comment">// Make sure this is after ExtractTextPlugin!</span></span><br><span class="line">  parts.purifyCSS(&#123;</span><br><span class="line">    <span class="comment">// Give paths to parse for rules. These should be absolute!</span></span><br><span class="line">    paths: glob.sync(<span class="string">`<span class="subst">$&#123;PATHS.app&#125;</span>/**/*.js`</span>, &#123; <span class="attr">nodir</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">]);</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/04/09/surviveJS-webpack-styling/purifycss.png" alt=""><br>可以看到CSS文件的大小明显变小了。<br>purifyCSS还支持minify。可以通过给plugin传递purifyOptions配置。如果purifyCSS不能挑选出你使用的CSS classes，可以通过purifyOptions.whitelist数组来定义一些selectors，使得这些selectors不管在什么情况下都可以保留。</p>
<p>使用purifyCSS后会丢失CSS source maps，即使你给Loaders配置了开启source maps.</p>
<h3 id="Critical-path-rendering"><a href="#Critical-path-rendering" class="headerlink" title="Critical path rendering"></a>Critical path rendering</h3><blockquote>
<p>The idea of <strong><a href="https://developers.google.com/web/fundamentals/performance/critical-rendering-path/" target="_blank" rel="noopener">critical path rendering</a></strong> takes a look at CSS performance from a different angle. Instead of optimizing for size, it optimizes for render order and emphasizes above-the-fold CSS. The result is achieved by rendering the page and then figuring out which rules are required to obtain the shown result.<br><code>webpack-critical</code> and <code>html-critical-webpack-plugin</code> implement the technique as a <code>HtmlWebpackPlugin</code>  plugin. <code>isomorphic-style-loader</code> achieves the same using webpack and React.<br>critical-path-css-tools by Addy Osmani lists other related tools.</p>
</blockquote>
<h2 id="Autoprefixing"><a href="#Autoprefixing" class="headerlink" title="Autoprefixing"></a>Autoprefixing</h2><p>自动添加前缀可以通过postCSS和autoprefixer插件实现。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add postcss-loader autoprefixer</span><br></pre></td></tr></table></figure></p>
<p>webpack.parts.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">exports.autoprefix = <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">  loader: <span class="string">"postcss-loader"</span>,</span><br><span class="line">  options: &#123;</span><br><span class="line">    plugins: <span class="function"><span class="params">()</span> =&gt;</span> [<span class="built_in">require</span>(<span class="string">"autoprefixer"</span>)()],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>结合ExtractTextPlugin一起使用：<br>webpack.config.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> productionConfig = merge([</span><br><span class="line">  parts.extractCSS(&#123;</span><br><span class="line">   use: [<span class="string">"css-loader"</span>, parts.autoprefix()],</span><br><span class="line">  &#125;),</span><br><span class="line">  ...</span><br><span class="line">]);</span><br></pre></td></tr></table></figure></p>
<p>如果你知道需要支持哪些浏览器，可以建一个<code>.browserslistrc</code>文件，autoprefixer和一些其他的工具都会用到这个件。<br>.browserslistrc<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; 1% # Browser usage over 1%</span><br><span class="line">Last 2 versions # Or last two versions</span><br><span class="line">IE 8 # Or IE 8</span><br></pre></td></tr></table></figure></p>
<p>app/main.css<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.pure-button</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-border-radius</span>: <span class="number">1em</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">1em</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>编译后的CSS文件是这样的：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.pure-button</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">1em</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>autoprefixer会删除一些不需要的规则，也会根据浏览器添加一些规则。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/05/surviveJS-webpack-developing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ailsa">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ailsa's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/05/surviveJS-webpack-developing/" itemprop="url">surviveJS-webpack-developing学习笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-05T22:42:07+08:00">2018-04-05</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/05/surviveJS-webpack-developing/" class="leancloud_visitors" data-flag-title="surviveJS-webpack-developing学习笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views:</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong><a href="https://survivejs.com/webpack/developing/" target="_blank" rel="noopener">surviveJS-webpack-developing</a></strong></p>
<h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><h2 id="首先安装webpack"><a href="#首先安装webpack" class="headerlink" title="首先安装webpack"></a>首先安装webpack</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack -D</span><br></pre></td></tr></table></figure>
<p>安装好webpack后，我们可以直接在控制台输入webpack，可以得到如下信息：<br><img src="/2018/04/05/surviveJS-webpack-developing/webpack-errors.png" alt=""><br>可以看到命令行提示我们安装webpack-cli，输入yes便可开始安装。安装完成后继续输入webpack:<br><img src="/2018/04/05/surviveJS-webpack-developing/webpack-console.png" alt=""><br>控制台的输出信息展示了：webpack的版本信息，hash信息以及编译时间和时长。</p>
<p>首先我们来看下第一个问题：<br>在控制台输入webpack执行了什么呢？<br>在控制台输入<code>yarn bin</code>,可以得到一条路径，一般是存放在node_modules/.bin目录下，进入.bin目录，可以看到如下的链接信息<br><img src="/2018/04/05/surviveJS-webpack-developing/webpack-bin.png" alt=""><br>进入webpack指向的文件,可以看到启动文件webpack.js如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runCommand</span>(<span class="params">command, options</span>) </span>&#123;</span><br><span class="line"><span class="comment">// install</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> webpackCliInstalled = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="built_in">require</span>.resolve(<span class="string">"webpack-cli"</span>);</span><br><span class="line">  webpackCliInstalled = <span class="literal">true</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  webpackCliInstalled = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!webpackCliInstalled) &#123;</span><br><span class="line">  <span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line">  <span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line">  <span class="keyword">const</span> readLine = <span class="built_in">require</span>(<span class="string">"readline"</span>);</span><br><span class="line">  <span class="keyword">const</span> isYarn = fs.existsSync(path.resolve(process.cwd(), <span class="string">"yarn.lock"</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> packageManager = isYarn ? <span class="string">"yarn"</span> : <span class="string">"npm"</span>;</span><br><span class="line">  <span class="keyword">const</span> options = [<span class="string">"install"</span>, <span class="string">"-D"</span>, <span class="string">"webpack-cli"</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isYarn) &#123;</span><br><span class="line">    options[<span class="number">0</span>] = <span class="string">"add"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> commandToBeRun = <span class="string">`<span class="subst">$&#123;packageManager&#125;</span> <span class="subst">$&#123;options.join(<span class="string">" "</span>)&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> question = <span class="string">`Would you like to install webpack-cli? (That will run <span class="subst">$&#123;commandToBeRun&#125;</span>) (yes/NO)`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.error(<span class="string">"The CLI moved into a separate package: webpack-cli"</span>);</span><br><span class="line">  <span class="keyword">const</span> questionInterface = readLine.createInterface(&#123;</span><br><span class="line">    input: process.stdin,</span><br><span class="line">    output: process.stdout</span><br><span class="line">  &#125;);</span><br><span class="line">  questionInterface.question(question, answer =&gt; &#123;</span><br><span class="line">    questionInterface.close();</span><br><span class="line">    <span class="keyword">switch</span> (answer.toLowerCase()) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"y"</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"yes"</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"1"</span>: &#123;</span><br><span class="line">        runCommand(packageManager, options)</span><br><span class="line">          .then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">"webpack-cli"</span>); <span class="comment">//eslint-disable-line</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(error);</span><br><span class="line">            process.exitCode = <span class="number">1</span>;</span><br><span class="line">          &#125;);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">default</span>: &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(</span><br><span class="line">          <span class="string">"It needs to be installed alongside webpack to use the CLI"</span></span><br><span class="line">        );</span><br><span class="line">        process.exitCode = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">"webpack-cli"</span>); <span class="comment">// eslint-disable-line</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到这个脚本主要内容就是加载webpack-cli，如果加载失败，输出错误信息，并引导用户安装webpack-cli。</p>
<p>然后我们来看截图中的问题：<br>首先是提示要指定mode，webpack新增指定mode为development或者production,会有一些默认的配置。这个warning可以通过运行<code>webpack --mode development</code>来解决。<br>第二个问题就是没有entry，即没有入口模块，下面开始添加入口。</p>
<h2 id="创建入口"><a href="#创建入口" class="headerlink" title="创建入口"></a>创建入口</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn init -y</span><br></pre></td></tr></table></figure>
<p>建立package.json文件,配置scripts命令：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts":&#123;</span><br><span class="line">  "prod": "webpack --mode production",</span><br><span class="line">  "dev": "webpack --mode development --devtool false"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>--devtool false</code>webpack会将生产的模板文件中的eval还原为原始代码。<br>然后新建两个测试文件</p>
<p>src/component.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (text = <span class="string">"Hello world"</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> element = <span class="built_in">document</span>.createElement(<span class="string">"div"</span>);</span><br><span class="line"></span><br><span class="line">  element.innerHTML = text;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> element;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>src/index.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> component <span class="keyword">from</span> <span class="string">"./component"</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(component());</span><br></pre></td></tr></table></figure></p>
<p>那么我们怎么在浏览器打开呢，还需要一个Html文件，我们可以使用html-webpack-plugin插件。<br>webpack.config.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  plugins:[</span><br><span class="line">    <span class="keyword">new</span> HtmlWebpackPlugin(&#123;<span class="attr">title</span>:<span class="string">'webpack'</span>&#125;)</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行<code>yarn run prod</code>，在浏览器中打开Html文件，就可以看到Hello world了。</p>
<h2 id="分析webpack输出"><a href="#分析webpack输出" class="headerlink" title="分析webpack输出"></a>分析webpack输出</h2><p>运行<code>yarn run prod</code>后，控制台输出如下：<br><img src="/2018/04/05/surviveJS-webpack-developing/webpack-prod.png" alt=""><br>我们可以看下此时的输出bundle是什么样子的：<br><img src="/2018/04/05/surviveJS-webpack-developing/webpack-prod-bundle.png" alt=""><br>mode为production时，输出的bundle会被压缩。</p>
<p>接下来我们再运行下<code>yarn run dev</code>, 观察控制台输出：<br><img src="/2018/04/05/surviveJS-webpack-developing/webpack-dev.png" alt=""><br>在development模式下，会默认使用NameModulesPlugin,所以在Prod模式下的那些moduleId,chunkId现在都变成了names形式。同样看下输出的bundle:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line">  <span class="comment">// The module cache</span></span><br><span class="line">  <span class="keyword">var</span> installedModules = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// The require function</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Check if module is in cache</span></span><br><span class="line">    <span class="keyword">if</span>(installedModules[moduleId]) &#123;</span><br><span class="line">        <span class="keyword">return</span> installedModules[moduleId].exports;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Create a new module (and put it into the cache)</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">module</span> = installedModules[moduleId] = &#123;</span><br><span class="line">        i: moduleId,</span><br><span class="line">        l: <span class="literal">false</span>,</span><br><span class="line">        exports: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Execute the module function</span></span><br><span class="line">    modules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Flag the module as loaded</span></span><br><span class="line">    <span class="built_in">module</span>.l = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return the exports of the module</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  __webpack_require__.xxx = xxx</span><br><span class="line"></span><br><span class="line">  <span class="comment">// __webpack_public_path__</span></span><br><span class="line">  __webpack_require__.p = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Load entry module and return exports</span></span><br><span class="line">  <span class="keyword">return</span> __webpack_require__(__webpack_require__.s = <span class="string">"./src/index.js"</span>);</span><br><span class="line">&#125;)</span><br><span class="line">(&#123;</span><br><span class="line"> <span class="string">"./src/component.js"</span>:(<span class="function"><span class="keyword">function</span>(<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"><span class="meta">  "use strict"</span>;</span><br><span class="line">  __webpack_require__.r(__webpack_exports__);</span><br><span class="line">  <span class="comment">/* harmony default export */</span> __webpack_exports__[<span class="string">"default"</span>] = <span class="function">(<span class="params">(text = <span class="string">"Hello world"</span></span>) =&gt;</span> &#123;<span class="comment">//component.js&#125;);</span></span><br><span class="line"> &#125;),</span><br><span class="line"> <span class="string">"./src/index.js"</span>: (<span class="function"><span class="keyword">function</span>(<span class="params">module, __webpack_exports__, __webpack_require__</span>) </span>&#123;</span><br><span class="line"><span class="meta">  "use strict"</span>;</span><br><span class="line">  __webpack_require__.r(__webpack_exports__);</span><br><span class="line">    <span class="comment">/* harmony import */</span> <span class="keyword">var</span> _component__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(<span class="comment">/*! ./component */</span> <span class="string">"./src/component.js"</span>);</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(<span class="built_in">Object</span>(_component__WEBPACK_IMPORTED_MODULE_0__[<span class="string">"default"</span>])());</span><br><span class="line">   &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>可以看到生成的bundle中其实就是一个即时函数，参数modules就是根据entry解析后所需要的模块。modules对象属性名为模块地址，属性值为一个函数，函数主体就是我们模块的主体，但是import,require都被替换成了<code>__webpack_require__</code>。<br>仔细看下这个<code>__webpack_require__</code>到底是做什么的？观察<code>__webpack_require__</code>函数，</p>
<ol>
<li>判断installedModules对象中是否存储了这个moduleId, 如果有，直接返回属性值的exports属性。</li>
<li>如果没有，则新建一个对象，<code>{i:moduleId, l:false, exports:{}}</code>, i表示id, l loaded表示是否加载，exports为空对象。 执行modules[moduleId]对应的函数，并传入<code>module, module.exports, __webpack_require__</code>，这就是为什么我们可以直接在文件中使用module,其实是webpack注入进来的。执行完对应的函数后，将loaded置为true，返回module.exports结果。</li>
</ol>
<p>至此，我们的demo已经可以打包运行了，但是每次修改还是需要手动运行，再刷新浏览器，下面我们就一起看看webpack-dev-server能否帮我们解决这个问题捏。</p>
<h1 id="webpack-dev-server"><a href="#webpack-dev-server" class="headerlink" title="webpack-dev-server"></a>webpack-dev-server</h1><h2 id="webpack-watch-mode"><a href="#webpack-watch-mode" class="headerlink" title="webpack watch mode"></a>webpack watch mode</h2><p>添加–watch参数，可以使webpack一直watching files，当文件改动时，可以自动编译， eg: <code>yarn run dev --watch</code>.<br>webpack-dev-server(WDS)也有watch的功能，并且更加强大。<br>WDS是运行在内存中的开发服务器，也就是说bundles不会输出到文件中，而是保存在内存中。WDS在你开发时，会监听文件的变化，自动编译自动刷新浏览器，并且支持webpack的热加载（HMR）功能。<br>虽然将文件保存在内存中，能提高性能，但有时候我们还是希望能输出到文件中，此时我们可以使用<code>write-file-webpack-plugin</code>插件。</p>
<p>##Getting started with WDS<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack-dev-server -D</span><br></pre></td></tr></table></figure></p>
<p>package.json<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"start":"webpack-dev-server --mode development"</span><br></pre></td></tr></table></figure></p>
<p>运行<code>yarn start</code>,可以看到控制台输出<br><img src="/2018/04/05/surviveJS-webpack-developing/webpack-dev-server.png" alt=""><br>在浏览器中打开localhost:8080就可以看到Hello world的界面啦.</p>
<h2 id="configuring-WDS"><a href="#configuring-WDS" class="headerlink" title="configuring WDS"></a>configuring WDS</h2><p>webpack.config.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line"></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    <span class="comment">// Display only errors to reduce the amount of output.</span></span><br><span class="line">    stats: <span class="string">"errors-only"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Parse host and port from env to allow customization.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// If you use Docker, Vagrant or Cloud9, set</span></span><br><span class="line">    <span class="comment">// host: options.host || "0.0.0.0";</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// 0.0.0.0 is available to all network devices</span></span><br><span class="line">    <span class="comment">// unlike default `localhost`.</span></span><br><span class="line">    host: process.env.HOST, <span class="comment">// Defaults to `localhost`</span></span><br><span class="line">    port: process.env.PORT, <span class="comment">// Defaults to 8080</span></span><br><span class="line">    open: <span class="literal">true</span>, <span class="comment">// Open the page in browser</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>这样配置后，可以通过<code>PORT=3000 yarn start</code>指定端口号。<br>虽然webpack-dev-server可以自动监听文件，但是却不能在webpack.config.js改变时，自动编译，我们只能在修改了配置后，重新启动服务才能生效。但是我们可以借助nodemon来监听webpack config file.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add nodemon -D</span><br></pre></td></tr></table></figure></p>
<p>package.json<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">"start": "nodemon --watch webpack.config.js --exec \"webpack-dev-server --mode development\""</span><br></pre></td></tr></table></figure></p>
<p>修改webpack.config.js，webpack就能够自动重新编译啦。</p>
<h2 id="Polling-instead-of-watching-files"><a href="#Polling-instead-of-watching-files" class="headerlink" title="Polling instead of watching files"></a>Polling instead of watching files</h2><p>在一些旧版本的window,ubuntu,vagarant和docker上watch文件可能会失效，这个时候就可以允许Polling了。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">  watchOptions: &#123;</span><br><span class="line">    <span class="comment">// Delay the rebuild after the first change</span></span><br><span class="line">    aggregateTimeout: <span class="number">300</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Poll using interval (in ms, accepts boolean too)</span></span><br><span class="line">    poll: <span class="number">1000</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>
<h2 id="other-features-of-webpack-dev-server"><a href="#other-features-of-webpack-dev-server" class="headerlink" title="other features of webpack-dev-server"></a>other features of webpack-dev-server</h2><ul>
<li>devServer.contentBase: 告诉服务器从哪里提供内容。只有在你想要提供静态文件时才需要。默认情况下，将使用当前工作目录作为提供内容的目录。</li>
<li>devServer.proxy:如果你有单独的后端开发服务器 API，并且希望在同域名下发送 API 请求 ，那么代理某些 URL 会很有用。<br><a href="https://www.webpackjs.com/configuration/dev-server/#devserver-proxy" target="_blank" rel="noopener">更多配置信息见官网</a></li>
</ul>
<h1 id="Composing-Configuration"><a href="#Composing-Configuration" class="headerlink" title="Composing Configuration"></a>Composing Configuration</h1><p>如果把我们的配置文件拆成很多部分，可以使用<code>webpack-merge</code>来将多个部分组合在一起：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add webpack-merge -D</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">merge = require(&apos;webpack-merge&apos;);</span><br><span class="line">merge(&#123;a:[1], b:2, c:3&#125;, &#123;a:[2], b:3, d:4&#125;)</span><br><span class="line">// &#123;a:[1,2], b:3, c:3, d:4&#125;</span><br></pre></td></tr></table></figure>
<p>对于这次的项目的配置文件，我们可以这样拆分组合：<br>webpack.parts.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">exports.devServer = <span class="function">(<span class="params">&#123; host, port &#125; = &#123;&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    stats: <span class="string">"errors-only"</span>,</span><br><span class="line">    host, <span class="comment">// Defaults to `localhost`</span></span><br><span class="line">    port, <span class="comment">// Defaults to 8080</span></span><br><span class="line">    open: <span class="literal">true</span>,</span><br><span class="line">    overlay: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>webpack.config.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">"webpack-merge"</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">"html-webpack-plugin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> parts = <span class="built_in">require</span>(<span class="string">"./webpack.parts"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> commonConfig = merge([</span><br><span class="line">  &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">      <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">"Webpack demo"</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> productionConfig = merge([]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> developmentConfig = merge([</span><br><span class="line">  parts.devServer(&#123;</span><br><span class="line">    <span class="comment">// Customize host/port here if needed</span></span><br><span class="line">    host: process.env.HOST,</span><br><span class="line">    port: process.env.PORT,</span><br><span class="line">  &#125;),</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">mode</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (mode === <span class="string">"production"</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> merge(commonConfig, productionConfig, &#123; mode &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> merge(commonConfig, developmentConfig, &#123; mode &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>配置文件最后直接返回了一个函数，接受cli传入的env. 这意味着package.json也应该有相应的修改：<br>package.json<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">  <span class="string">"start"</span>: <span class="string">"nodemon --watch webpack.config.js exec \"webpack-dev-server --env development\""</span>,</span><br><span class="line">  <span class="string">"build"</span>: <span class="string">"webpack --env production"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/02/what-is-webpack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ailsa">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ailsa's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/02/what-is-webpack/" itemprop="url">what is webpack</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-04-02T19:27:50+08:00">2018-04-02</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/04/02/what-is-webpack/" class="leancloud_visitors" data-flag-title="what is webpack">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views:</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong><a href="https://survivejs.com/webpack/what-is-webpack/" target="_blank" rel="noopener">what is webpack</a></strong>学习笔记。</p>
<p>webpack是一个模块打包工具，它依赖模块。即使是一个很小的项目，利用webpack来打包，一般会包括entry和Output.打包就是从用户自定义的entry开始进行的。entry本身也是模块，并且可以通过import导入其他的模块。当你使用webpack打包项目时，webpack会通过Import来构建项目的依赖图（dependency graph），并根据webpack配置输出output。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/26/http-hash-router/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ailsa">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ailsa's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/26/http-hash-router/" itemprop="url">http-hash-router source</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-26T15:18:06+08:00">2018-03-26</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/sourcecode/" itemprop="url" rel="index"><span itemprop="name">sourcecode</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/26/http-hash-router/" class="leancloud_visitors" data-flag-title="http-hash-router source">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views:</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Server route handler for http-hash</p>
<h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HttpHashRouter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> hash = HttpHash();</span><br><span class="line"></span><br><span class="line">  handleRequest.hash = hash;</span><br><span class="line">  handleRequest.set = set;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> handleRequest;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">name, handler</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (handler &amp;&amp; <span class="keyword">typeof</span> handler === <span class="string">'object'</span>) &#123;</span><br><span class="line">      handler = httpMethods(handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> hash.set(name, handler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleRequest</span>(<span class="params">req, res, opts, cb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> cb !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> ExpectedCallbackError(&#123;</span><br><span class="line">        value: cb</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> pathname = url.parse(req.url).pathname;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> route = hash.get(pathname);</span><br><span class="line">    <span class="keyword">if</span> (route.handler === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> cb(NotFoundError(&#123;</span><br><span class="line">        pathname: pathname</span><br><span class="line">      &#125;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    opts = extend(opts, &#123;</span><br><span class="line">      params: route.params,</span><br><span class="line">      splat: route.splat</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> route.handler(req, res, opts, cb);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在httpHashRouter函数中会初始化一个http-hash实例hash，并且将hash绑定在返回的handleRequest函数上,同时还会绑定一个set方法。</p>
<h2 id="handleRequest-req-res-opts-cb"><a href="#handleRequest-req-res-opts-cb" class="headerlink" title="handleRequest(req, res, opts, cb)"></a>handleRequest(req, res, opts, cb)</h2><p>handleRequest是httpHashRouter返回的函数，接受四个参数，<br>第一二个参数分别为HTTPRequest和HTTPResponse;<br>第三个参数为Options对象;<br>第四个参数为callback，这个函数可能被传入http-hash-router.not-found error，或者是传递给route.handler,省略该参数, 会报http-hash-router.expected-callback异常。</p>
<p>handleRequest会根据req.url获取pathname,然后利用hash.get(pathname)获取解析后的route对象，根据<strong><a href="/2018/03/25/http-hash-source/">上一篇博文</a></strong>可以知道该对象结构为：<code>{handler, splat, params, src}</code>。如果route.handler为null，表示没有找到与当前路径匹配的路由。如果找到了对应的路由，则将params, splats复制到options参数上，调用route.handler.</p>
<p>总结：<br>handleRequest函数的作用其实就是从路由树中，找到匹配当前路径的节点，并通知handler。（handler是在hash.set(name, handler)时指定的）。</p>
<h2 id="set-name-handler"><a href="#set-name-handler" class="headerlink" title="set(name, handler)"></a>set(name, handler)</h2><p>调用set方法，会将传入的路由及其对应的handler存储在路由树中。<br>这里handler可以是函数或者对象，如果使用对象，会利用http-methods模块转为handler函数。<br>set方法实际上是使用的http-hash.set方法，可以通过<strong><a href="/2018/03/25/http-hash-source/">上一篇博文</a></strong>查看。<br>handler在调用时会传入四个参数，handler(req, res, opts, cb).</p>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> HttpHashRouter = <span class="built_in">require</span>(<span class="string">'http-hash-router'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> router = HttpHashRouter();</span><br><span class="line"></span><br><span class="line">router.set(<span class="string">'/health'</span>, <span class="function"><span class="keyword">function</span> <span class="title">health</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  res.end(<span class="string">'OK'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span> <span class="title">handler</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  router(req, res, &#123;&#125;, onError);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onError</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="comment">// use your own custom error serialization.</span></span><br><span class="line">      res.statusCode = err.statusCode || <span class="number">500</span>;</span><br><span class="line">      res.end(err.message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://github.com/Matt-Esch/http-hash-router" target="_blank" rel="noopener">http-hash-router github</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/25/http-hash-source/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ailsa">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ailsa's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/25/http-hash-source/" itemprop="url">http-hash source</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-25T10:47:04+08:00">2018-03-25</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/sourcecode/" itemprop="url" rel="index"><span itemprop="name">sourcecode</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/25/http-hash-source/" class="leancloud_visitors" data-flag-title="http-hash source">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views:</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这篇笔记主要是记录下http-hash的源码。</p>
<blockquote>
<p>http-hash solves the routing problem by making route resolution independent of the order in which routes are defined. It does so by breaking a path into a tree of nodes, based on a simple split on /. For example, the route /foo/bar/baz is treated as tree nodes foo &gt; bar &gt; baz. We call foo, bar and baz path segments.</p>
</blockquote>
<h2 id="总体结构"><a href="#总体结构" class="headerlink" title="总体结构"></a>总体结构</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HttpHash</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> HttpHash)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HttpHash();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>._hash = <span class="keyword">new</span> RouteNode();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">HttpHash.prototype.get = get;</span><br><span class="line">HttpHash.prototype.set = set;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>http-hash exports a safe constructor function that when called returns a new HttpHash. get and set methods are exposed for public consumption and the underlying data structure _hash is exposed for private inspection/internal use.</p>
</blockquote>
<h2 id="this-hash"><a href="#this-hash" class="headerlink" title="this._hash"></a>this._hash</h2><p>在http-hash的构造函数中，this._hash = new RouteNode()，那么this._hash到底是什么样的结构呢？我们看下RouteNode这个函数:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RouteNode</span>(<span class="params">parent, segment, isSplat</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.parent = parent || <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.segment = segment || <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.handler = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.staticPaths = &#123;&#125;;</span><br><span class="line">  <span class="keyword">this</span>.variablePaths = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.isSplat = !!isSplat;</span><br><span class="line">  <span class="keyword">this</span>.src = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>this._hash初始化时，是没有给RouteNode传入任何参数的，所以<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>._hash = &#123;</span><br><span class="line">  parent: <span class="literal">null</span>,</span><br><span class="line">  segment: <span class="literal">null</span>,</span><br><span class="line">  handler: <span class="literal">null</span>,</span><br><span class="line">  staticPaths: &#123;&#125;,</span><br><span class="line">  variablePaths: <span class="literal">null</span>,</span><br><span class="line">  isSplat: <span class="literal">false</span>,</span><br><span class="line">  src: <span class="literal">null</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="set-pathname-handler"><a href="#set-pathname-handler" class="headerlink" title="set(pathname, handler)"></a>set(pathname, handler)</h2><p>接下来就是set方法了，set方法接收两个参数：pathname和handler<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">pathname, handler</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 分隔pathname，获取最后一级路径的位置；</span></span><br><span class="line">  <span class="comment">// 判断pathname中是否含有*</span></span><br><span class="line">  <span class="keyword">var</span> pathSegments = pathname.split(<span class="string">'/'</span>);</span><br><span class="line">  <span class="keyword">var</span> hash = <span class="keyword">this</span>._hash;</span><br><span class="line">  <span class="keyword">var</span> lastIndex = pathSegments.length - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">var</span> splatIndex = pathname.indexOf(<span class="string">'*'</span>);</span><br><span class="line">  <span class="keyword">var</span> hasSplat = splatIndex &gt;= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果pathname中有*，并且*号位置不在最后一级路径上，即不满足/p/a/t/h/*的路径，抛错</span></span><br><span class="line">  <span class="keyword">if</span> (hasSplat &amp;&amp; splatIndex !== pathname.length - <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> SplatError(pathname);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pathSegments.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> segment = pathSegments[i];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!segment) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (hasSplat &amp;&amp; i === lastIndex) &#123;</span><br><span class="line">      hash = (</span><br><span class="line">        hash.variablePaths ||</span><br><span class="line">        (hash.variablePaths = <span class="keyword">new</span> RouteNode(hash, segment, <span class="literal">true</span>))</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// /foo/:param 和 /foo/* 的情况</span></span><br><span class="line">      <span class="keyword">if</span> (!hash.isSplat) &#123;</span><br><span class="line">        <span class="keyword">throw</span> RouteConflictError(pathname, hash);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (segment.indexOf(<span class="string">':'</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">      segment = segment.slice(<span class="number">1</span>);</span><br><span class="line">      hash = (</span><br><span class="line">        hash.variablePaths ||</span><br><span class="line">        (hash.variablePaths = <span class="keyword">new</span> RouteNode(hash, segment))</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// /foo/:param1 和 /foo/:param2</span></span><br><span class="line">      <span class="comment">// /foo/* 和 /foo/:param 两种冲突情况</span></span><br><span class="line">      <span class="keyword">if</span> (hash.segment !== segment || hash.isSplat) &#123;</span><br><span class="line">        <span class="keyword">throw</span> RouteConflictError(pathname, hash);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (segment === <span class="string">'__proto__'</span>) &#123;</span><br><span class="line">      hash = (</span><br><span class="line">        (</span><br><span class="line">          hash.hasOwnProperty(<span class="string">'proto'</span>) &amp;&amp;</span><br><span class="line">          hash.proto</span><br><span class="line">        ) ||</span><br><span class="line">        (hash.proto = <span class="keyword">new</span> RouteNode(hash, segment))</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      hash = (</span><br><span class="line">        (</span><br><span class="line">          hash.staticPaths.hasOwnProperty(segment) &amp;&amp;</span><br><span class="line">          hash.staticPaths[segment]</span><br><span class="line">        ) ||</span><br><span class="line">        (hash.staticPaths[segment] = <span class="keyword">new</span> RouteNode(hash, segment))</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (hash.handler === <span class="literal">null</span>) &#123;</span><br><span class="line">    hash.src = pathname;</span><br><span class="line">    hash.handler = handler;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 同一路径，不同handler冲突</span></span><br><span class="line">    throwRouteConflictError(pathname, hash);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在set函数主体的for循环中，会对每一级路径进行判断</p>
<ul>
<li>如果pathname中有*，且循环到了最后一级路径，先检查当前hash是否存在variablePaths, 如果不存在hash.variablePaths赋值new RouteNode(hash, segment, true)</li>
<li>如果当前这级路径含有:，去掉:，取变量名，当前hash不存在variablePaths，给hash.variablePaths赋值</li>
<li>如果当前路径为<em>proto</em>，当hash有proto属性，并且proto属性存在时，不做处理，否则赋值new RouteNode(hash, segment)</li>
<li>以上情况都不满足时，就认为是普通路径，检查hash.staticPaths是否存在【segment】属性，不存在时，赋值new RouteNode(hash, segment)<br>最后会把hash.src赋值为pathname，hash.handler赋值为传入的handler</li>
</ul>
<p>下面是用树状图画的这个赋值过程，假设set(‘/foo/bar/:param/*’,emptyFunc);<br><img src="/2018/03/25/http-hash-source/xmind.png" alt=""><br>上面这个树状图很清楚的表现了set后的对象结构，非变量路径存放在staticPath下，变量形式的路径存放在variablePaths下。</p>
<h2 id="get-pathname"><a href="#get-pathname" class="headerlink" title="get(pathname)"></a>get(pathname)</h2><p>最后我们再看下get方法<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params">pathname</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> pathSegments = pathname.split(<span class="string">'/'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> hash = <span class="keyword">this</span>._hash;</span><br><span class="line">  <span class="keyword">var</span> splat = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">var</span> params = &#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> variablePaths;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pathSegments.length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> segment = pathSegments[i];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 匹配 ’‘ 或者 多个/ eg: ///</span></span><br><span class="line">    <span class="keyword">if</span> (!segment &amp;&amp; !hash.isSplat) &#123;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="comment">// 优先匹配_proto_</span></span><br><span class="line">      segment === <span class="string">'__proto__'</span> &amp;&amp;</span><br><span class="line">      hash.hasOwnProperty(<span class="string">'proto'</span>)</span><br><span class="line">    ) &#123;</span><br><span class="line">      hash = hash.proto;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hash.staticPaths.hasOwnProperty(segment)) &#123; <span class="comment">// 其次是staticPaths</span></span><br><span class="line">      hash = hash.staticPaths[segment];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((variablePaths = hash.variablePaths)) &#123; <span class="comment">// 接下来是variablePath</span></span><br><span class="line">      <span class="comment">// 如果isSplat标记为true，表示*匹配，则将pathSegments后面的路径用/拼接，循环终止</span></span><br><span class="line">      <span class="comment">// 否则表示是:param匹配，存在params对象中</span></span><br><span class="line">      <span class="keyword">if</span> (variablePaths.isSplat) &#123;</span><br><span class="line">        splat = pathSegments.slice(i).join(<span class="string">'/'</span>);</span><br><span class="line">        hash = variablePaths;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        params[variablePaths.segment] = segment;</span><br><span class="line">        hash = variablePaths;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      hash = <span class="literal">null</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 当hash还存在下一级树形结构*，但是并没有匹配到时，eg:/foo/bar/test</span></span><br><span class="line">  <span class="keyword">if</span> (hash &amp;&amp;</span><br><span class="line">    hash.handler === <span class="literal">null</span> &amp;&amp;</span><br><span class="line">    hash.variablePaths &amp;&amp;</span><br><span class="line">    hash.variablePaths.isSplat</span><br><span class="line">  ) &#123;</span><br><span class="line">    splat = <span class="string">''</span>;</span><br><span class="line">    hash = hash.variablePaths;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> RouteResult(hash, params, splat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里以<code>get(&#39;/foo/bar/test/p/a/t/h&#39;)</code>为例：</p>
<ol>
<li>以/为标志分隔字符串<br><code>pathSegments = [&#39;&#39;,&#39;foo&#39;,&#39;bar&#39;,&#39;test&#39;,&#39;p&#39;.&#39;a&#39;,&#39;t&#39;,&#39;h&#39;]</code><br>这里的this._hash是上图中的结构</li>
<li>这里数组中第一个元素为空已经跳过循环，数组中不存在<em>proto</em>，开始检查hash.staticPaths,从上图可以看到<code>hash.staticPaths={foo:{...}}</code>结构，所以<br><code>hash = this._hash.staticPaths.foo</code>,<br>后面的bar也是存放在staticPaths下面的，因此<br><code>hash = this._hash.staticPaths.foo.staticPaths.bar</code></li>
<li>循环到test时，<code>hash.staticPaths={}</code>, 查看variablePaths, 当前variablePaths.isSplat为false，进入else分支，<br><code>params.param = test</code>,<br><code>hash = this._hash.staticPaths.foo.staticPaths.bar.variablePaths</code></li>
<li><p>循环到p时， <code>hash.staticPaths ={}</code>,查看hash.variablePaths结构如下，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hash.variablePaths=&#123;</span><br><span class="line">  segment:*,</span><br><span class="line">  handler:emptyFunc,</span><br><span class="line">  isSpat:true,</span><br><span class="line">  src:&apos;/foo/bar/:params/*&apos;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以<code>splat=&#39;p/a/t/h&#39;</code>,<br><code>hash = this._hash.staticPaths.foo.staticPaths.bar.variablePaths.variablePaths</code></p>
</li>
<li>返回RouteResult实例,<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  handler: handler,</span><br><span class="line">  splat: &apos;p/a/t/h&apos;,</span><br><span class="line">  params: &#123;param:test&#125;,</span><br><span class="line">  src: &apos;/foo/bar/:param/*</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>RouteResult函数如下：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">RouteResult</span>(<span class="params">node, params, splat</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.handler = node &amp;&amp; node.handler || <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.splat = splat;</span><br><span class="line">  <span class="keyword">this</span>.params = params;</span><br><span class="line">  <span class="keyword">this</span>.src = node &amp;&amp; node.src || <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>Since a node can have both static and dynamic paths associated with it, the static path will win over the variable path when we resolve the path.</p>
</blockquote>
<h2 id="Path-Conflicts"><a href="#Path-Conflicts" class="headerlink" title="Path Conflicts"></a>Path Conflicts</h2><p>如果有路由冲突，程序会抛出异常。下面说一下冲突的发生：</p>
<ol>
<li>同一个路径，定义了不同的handler</li>
<li>路径的变量名不一致<br>eg: /foo/:vara/ 和 /foo/:varb/ 冲突，因为都能匹配foo.variablePaths, 却有不同的param names。</li>
<li>A variable route is defined for a splat node<br>当splats和变量路径定义在同一等级上，比如/foo/:var 和 /foo/<em> 这样就会有冲突<br>但如果是静态路径和splat在同一级上就没有问题，eg: /foo/bar 和 /foo/</em>，这种情况下静态路径的优先级高于splat</li>
</ol>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://github.com/Matt-Esch/http-hash" target="_blank" rel="noopener">http-hash github</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/03/23/start-hexo-blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ailsa">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ailsa's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/23/start-hexo-blog/" itemprop="url">HEXO & Next to start a blog</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-03-23T18:05:19+08:00">2018-03-23</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/others/" itemprop="url" rel="index"><span itemprop="name">others</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/03/23/start-hexo-blog/" class="leancloud_visitors" data-flag-title="HEXO & Next to start a blog">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Views:</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>开始搭建博客前，请安装好git，yarn或者npm工具。</p>
<h2 id="本地博客搭建"><a href="#本地博客搭建" class="headerlink" title="本地博客搭建"></a>本地博客搭建</h2><h3 id="创建博客目录"><a href="#创建博客目录" class="headerlink" title="创建博客目录"></a>创建博客目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir blogName</span><br><span class="line">cd blogName</span><br></pre></td></tr></table></figure>
<h3 id="安装hexo及其依赖"><a href="#安装hexo及其依赖" class="headerlink" title="安装hexo及其依赖"></a>安装hexo及其依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yarn global add hexo</span><br><span class="line">hexo init</span><br></pre></td></tr></table></figure>
<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure>
<p>本地博客搭建完成，现在可以通过控制台的提示访问自己的博客哒。</p>
<h2 id="关联本地博客和github"><a href="#关联本地博客和github" class="headerlink" title="关联本地博客和github"></a>关联本地博客和github</h2><p>新建仓库名为 “github账号.github.io”</p>
<h3 id="在hexo配置文件中关联github仓库地址"><a href="#在hexo配置文件中关联github仓库地址" class="headerlink" title="在hexo配置文件中关联github仓库地址"></a>在hexo配置文件中关联github仓库地址</h3><p>编辑_config.yml<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: https://github.com/xxx/xxx.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure></p>
<h3 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add hexo-deployer-git</span><br></pre></td></tr></table></figure>
<h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure>
<p>现在博客就部署好啦，可以通过<a href="https://github账号.github.io/" target="_blank" rel="noopener">https://github账号.github.io/</a> 访问自己的博客页面。</p>
<h2 id="Next主题安装"><a href="#Next主题安装" class="headerlink" title="Next主题安装"></a>Next主题安装</h2><h3 id="下载主题"><a href="#下载主题" class="headerlink" title="下载主题"></a>下载主题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd blogName</span><br><span class="line">git clone https://github.com/theme-next/hexo-theme-next.git themes/next</span><br></pre></td></tr></table></figure>
<h3 id="启用主题"><a href="#启用主题" class="headerlink" title="启用主题"></a>启用主题</h3><p>编辑blogName/_config.yml文件，将theme字段改为next<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme: next</span><br></pre></td></tr></table></figure></p>
<p>编辑blogName/themes/next/_config.yml, 会看到有几行scheme的配置, 删除你想要的主题前的#号，就可以启用该主题。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Schemes</span><br><span class="line">#scheme: Muse</span><br><span class="line">scheme: Mist</span><br><span class="line">#scheme: Pisces</span><br><span class="line">#scheme: Gemini</span><br></pre></td></tr></table></figure></p>
<h3 id="设置语言"><a href="#设置语言" class="headerlink" title="设置语言"></a>设置语言</h3><p>编辑blogName/_config.yml，设置language: zh-Hans为汉字, en为英语。</p>
<h3 id="设置头像"><a href="#设置头像" class="headerlink" title="设置头像"></a>设置头像</h3><p>编辑blogName/themes/next/_config.yml, 设置avatar字段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Sidebar Avatar</span><br><span class="line"># in theme directory(source/images): /images/avatar.gif</span><br><span class="line"># in site  directory(source/uploads): /uploads/avatar.gif</span><br><span class="line">avatar: /images/avatar.png</span><br></pre></td></tr></table></figure></p>
<p>注释都有很清晰的说明，如果放在source/uploads（可能需要自己建）下,使用/uploads/filename引入；如果放在source/images下，使用/images/filename引入；也可以直接使用完整的互联网URI。</p>
<h3 id="设置作者昵称-amp-站点描述"><a href="#设置作者昵称-amp-站点描述" class="headerlink" title="设置作者昵称&amp;站点描述"></a>设置作者昵称&amp;站点描述</h3><p>编辑blogName/_config.yml, author字段设置昵称，description字段为站点描述。</p>
<h3 id="设置菜单"><a href="#设置菜单" class="headerlink" title="设置菜单"></a>设置菜单</h3><h4 id="设置菜单内容"><a href="#设置菜单内容" class="headerlink" title="设置菜单内容"></a>设置菜单内容</h4><p>编辑blogName/themes/next/_config.yml的menu字段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: / || home</span><br><span class="line">  #about: /2018/03/23/hello-world/ || user</span><br><span class="line">  #tags: /tags/ || tags</span><br><span class="line">  #categories: /categories/ || th</span><br><span class="line">  archives: /archives/ || archive</span><br><span class="line">  #schedule: /schedule/ || calendar</span><br><span class="line">  #sitemap: /sitemap.xml || sitemap</span><br><span class="line">  #commonweal: /404/ || heartbeat</span><br></pre></td></tr></table></figure></p>
<h4 id="设置菜单显示文本-amp-显示图标"><a href="#设置菜单显示文本-amp-显示图标" class="headerlink" title="设置菜单显示文本&amp;显示图标"></a>设置菜单显示文本&amp;显示图标</h4><p>进入blogName/themes/next/languages下找到你的语言对应的配置文件，即可更改显示文本<br>编辑blogName/themes/next/_config.yml的menu_icons字段可以控制显示图标，icon name 是 Font Awesome 图标的名字。</p>
<h2 id="集成常用第三方服务"><a href="#集成常用第三方服务" class="headerlink" title="集成常用第三方服务"></a>集成常用第三方服务</h2><h3 id="百度统计"><a href="#百度统计" class="headerlink" title="百度统计"></a>百度统计</h3><ol>
<li>登录<a href="https://tongji.baidu.com/web/25355866/welcome/login" target="_blank" rel="noopener">百度统计</a>,选择网站统计&gt;管理&gt;新增网站&gt;输入博客域名和地址<br><img src="/2018/03/23/start-hexo-blog/baidu_analytic.png" alt=""></li>
<li>进入代码获取&gt;代码管理页面，复制代码框中hm.src字段对应的网址?后的id<br><img src="/2018/03/23/start-hexo-blog/analytic_id.png" alt=""></li>
<li>编辑blogName/themes/next/_config.yml文件的baidu_analytics字段为刚刚复制的id</li>
<li>20分钟后脚本生效，便可登录查看你的博客的访问pv,uv了。</li>
</ol>
<h3 id="博客阅读次数统计"><a href="#博客阅读次数统计" class="headerlink" title="博客阅读次数统计"></a>博客阅读次数统计</h3><ol>
<li>配置<a href="https://leancloud.cn/" target="_blank" rel="noopener">LeanCloud</a></li>
<li>选择应用，创建新应用&gt;输入应用名称&gt;点击创建<br><img src="/2018/03/23/start-hexo-blog/lean_new_apply.png" alt=""></li>
<li>点击已创建的应用，进入数据页面&gt;创建class&gt;输入Class名称为Counter&gt;选择无限制&gt;点击创建class，就可以看到Counter表了<br><img src="/2018/03/23/start-hexo-blog/lean_new_class.png" alt=""></li>
<li>选择设置&gt;应用key&gt;复制appid&amp;appKey<br><img src="/2018/03/23/start-hexo-blog/lean_get_appid.png" alt=""></li>
<li><p>编辑blogName/themes/next/_config.yml, 将enable设为true，黏贴复制的appid和appkey</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Show number of visitors to each article.</span><br><span class="line"># You can visit https://leancloud.cn get AppID and AppKey.</span><br><span class="line">leancloud_visitors:</span><br><span class="line">  enable: true</span><br><span class="line">  app_id: appid</span><br><span class="line">  app_key: appkey</span><br></pre></td></tr></table></figure>
</li>
<li><p>web安全<br>进入web安全中心，在web安全域名中输入我们的博客域名以确保数据调用安全。<br><img src="/2018/03/23/start-hexo-blog/lean_safe.png" alt=""><br>如果安全域名填写错误，并不是我们的博客地址，打开博客页面的控制台可以看到403的报错信息。</p>
</li>
</ol>
<h2 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h2><ol>
<li><p>create new post</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo new &quot;My New Post&quot; </span><br><span class="line">hexo new test // 创建test.md同时创建test文件夹</span><br></pre></td></tr></table></figure>
</li>
<li><p>清楚缓存</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br></pre></td></tr></table></figure>
</li>
<li><p>编译文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br><span class="line">hexo g</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动本地服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo server</span><br><span class="line">hexo s</span><br><span class="line">hexo s --debug</span><br></pre></td></tr></table></figure>
</li>
<li><p>部署到git</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo deploy</span><br><span class="line">hexo d</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><ol>
<li><p>在web安全中心设置完域名后，页面白屏<br>可以检查下域名后面是否写了/，比如<a href="http://www.baidu.com写成了http://www.baidu.com/" target="_blank" rel="noopener">http://www.baidu.com写成了http://www.baidu.com/</a></p>
</li>
<li><p>hexo在本地引入图片失败<br>编辑blogName/_config.yml,设置post_asset_folder:true<br>安装插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add https://github.com/CodeFalling/hexo-asset-image</span><br></pre></td></tr></table></figure>
</li>
<li><p>更换主题后，重新运行本地服务，主题没有生效<br>可以运行hexo clean来清除下缓存</p>
</li>
</ol>
<h2 id="参考博文"><a href="#参考博文" class="headerlink" title="参考博文"></a>参考博文</h2><p><a href="https://notes.wanghao.work/2015-10-21-%E4%B8%BANexT%E4%B8%BB%E9%A2%98%E6%B7%BB%E5%8A%A0%E6%96%87%E7%AB%A0%E9%98%85%E8%AF%BB%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%8A%9F%E8%83%BD.html#%E9%85%8D%E7%BD%AELeanCloud" target="_blank" rel="noopener">leanCloud</a><br><a href="http://theme-next.iissnan.com/getting-started.html#select-scheme" target="_blank" rel="noopener">开始使用Next</a><br><a href="http://juanha.coding.me/2016/10/21/hexo-blog-build/" target="_blank" rel="noopener">搭建个人博客</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="Ailsa" />
            
              <p class="site-author-name" itemprop="name">Ailsa</p>
              <p class="site-description motion-element" itemprop="description">Front End Engineer</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">categories</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate"> 
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ailsa</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.0.6</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.6"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.6"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.6"></script>



  



	





  





  










  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("1nV85N21T6AO0avUlypxP9SI-gzGzoHsz", "wtpWsIgedu3sVOq1dgtWUiix");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            
            counter.save(null, {
              success: function(counter) {
                
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.get('time'));
                
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            
              var newcounter = new Counter();
              /* Set ACL */
              var acl = new AV.ACL();
              acl.setPublicReadAccess(true);
              acl.setPublicWriteAccess(true);
              newcounter.setACL(acl);
              /* End Set ACL */
              newcounter.set("title", title);
              newcounter.set("url", url);
              newcounter.set("time", 1);
              newcounter.save(null, {
                success: function(newcounter) {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
                },
                error: function(newcounter, error) {
                  console.log('Failed to create');
                }
              });
            
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  
  

  

  

  

  

</body>
</html>
